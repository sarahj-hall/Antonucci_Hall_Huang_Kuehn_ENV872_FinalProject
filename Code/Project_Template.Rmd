---
title: 'Power Outage Trends in California, Florida, Pennsylvania, and Texas from 2015 to 2023'
subtitle: 'https://github.com/sarahj-hall/Antonucci_Hall_Huang_Kuehn_ENV872_FinalProject.git'
authors: 'Addisen Antonucci, Sarah Hall, Carina Huang, and Isabelle Kuehn'
date: 'December 12th, 2025'

output: 
  bookdown::pdf_document2:
    toc: false 
    latex_engine: xelatex
editor_options:
  chunk_output_type: console
---
\newpage
\setcounter{tocdepth}{3}
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Load your packages
library(tidyverse)
library(here)
library(lubridate)
library(viridis)
library(zoo)
library(trend)
library(Kendall)
library(cowplot)
library(knitr)
library(kableExtra)

# Set your working directory
here()

# Set ggplot theme
mytheme <- theme_classic(base_size = 10) +
  theme(plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
        axis.title.x = element_text(size = 10.5),
        axis.title.y = element_text(size = 10.5))
theme_set(mytheme)

#set global chunk options
knitr::opts_chunk$set(
  echo = FALSE,      # hide all code
  warning = FALSE,   # hide warnings
  message = FALSE,   # hide messages
  fig.align = "center") #center figures 

# Load your datasets

#load CA data
#read in CA data from processed folder 
outage_group_CA <- read.csv(here('Data/Processed/outage_group_CA.csv'), 
                            stringsAsFactors = TRUE)
#format date column
outage_group_CA$date <- ymd(outage_group_CA$date)


#load FL data
outage_group_FL <- read.csv(here('Data/Processed/outage_group_FL.csv'), 
                            stringsAsFactors = TRUE)
#format date column
outage_group_FL$date <- ymd(outage_group_FL$date)

#load PA data
outage_group_PA <- read.csv(here('Data/Processed/outage_group_PA.csv'), 
                    stringsAsFactors = TRUE)
outage_group_PA$date <- ymd(outage_group_PA$date)

#load TX data
outage_group_TX <- read.csv(here('Data/Processed/outage_group_TX.csv'))
outage_group_TX$date <- ymd(outage_group_TX$date)

```


# Rationale and Research Questions
Electric power outages are costly for both utilities and their customers. Outages disrupt economic activity, and impact critical facilities such as hospitals (Wing et al., 2025). The United States electric grid is increasingly vulnerable to outages due to increasing extreme weather events, such as hurricanes, heatwaves, wildfires, and winter storms, which are increasing in frequency and intensity due to climate change (Wendel, 2024). Because many of these events occur during specific times of the year, understanding weather power outages follow a seasonal pattern is important for planning and resilience. If outages tend to occur in specific months, utilities and communities can better allocate resources, resilience investments, and emergency preparedness.

At the same time, electric utilities have made advancements in system planning, grid hardening, and outage detection (IBM, 2025). Together this raises key questions about whether outages are becoming more or less frequent, whether they show predictable seasonal cycles, and whether their impacts are increasing over time. 

To address these questions, this study focuses on Texas, California, Florida, and Pennsylvania. These states represent diverse geographic regions, climates, and electric power systems. For each state, the study examines trends in the number of power outages, seasonality, and severity of outages. Customer weighted hours of outages will be used to quantify the impact of outages, as it combines the number of customers affected with the outage duration. 
 
The research questions of this study are: 

- Question 1: How has the number of power outages changed over time?
- Question 2: Is there a seasonal trend? Are certain months more prone to outages? 
- Question 3: How has the severity of power outages changed over time? 

We hypothesize that (1) the number of power outages have increased over time in response to rising extreme climate events, (2) that each state has distinct seasonal power outage patterns related to its dominant weather hazards, and (3) the severity of power outages have increase over time, which will be reflected in an increase in the customer weighted ours of outages. 

\newpage

# Dataset Information
The Event-correlated Outage Dataset in America by the Pacific Northwest National Laboratory was downloaded from the Open Energy Data Initiative (OEDI) (<https://data.openei.org/submissions/6458>). The dataset includes an aggregated and event-correlated analysis of power outages in the United States. The specific dataset selected for this analysis is the Aggregated Outage Data which integrates data from the Environment for the Analysis of Geo-Located Energy Information (EAGLE-I), and Annual Estimates of the Resident Population for Counties 2024 (CO-EST2024-POP). The EAGLE-I dataset, provides county-level electricity outage estimates at 15-minute intervals from 2014 to 2023. It encompasses over 146 million customers, but this coverage has increased over time from 137 million in 2018. EAGLE-I only started providing data quality estimates starting in 2018. The Aggregated Outage Dataset provides monthly outage data at the state level, including total number of outages, the maximum duration of outages, and the customer weighted average of outages.   

The data was wrangled by combining the yearly data from 2015 to 2023 into one dataframe. The year 2014 was removed from the analysis because it did not have monthly data, only the yearly summary. From this file, four datasets were created by filtering for each state (CA, FL, PA, and TX). For each state, the monthly value equal to 0 was filtered out, which represented the yearly summary. Additionally, a date column was added that combined the monthly and yearly columns into a date object.

This data structure shown in Table \@ref(tab:datastructuretable) applies to all four state datasets. Table \@ref(tab:datasummary) summarizes the key statistical characteristics of each datasets. 

```{r datastructuretable, tab.cap="Summary of Outage Dataset Structure"}
structure_tbl <- tibble::tribble(
  ~Variable, ~Description, ~Units,
  "state", "Two-letter state abbreviation", "N/A",
  "year", "Year of outage", "N/A",
  "month", "Month of outage", "N/A",
  "outage_count", "Number of outages per month", "N/A",
  "max_outage_duration", "Longest outage duration in a month", "Hours",
  "customer_weighted_hours", "Customer-weighted outage hours", "N/A",
  "date", "Date of outage", "N/A")

kable(structure_tbl, booktabs = TRUE)%>%
  kable_styling(
    position = "center",
    full_width = FALSE,
    latex_options = "hold_position")   # forces placement of table here
```

```{r datasummary, tab.cap= "Summary Statistics of CA, FL, PA, and TX Datasets"}

#combine datasets
all_states <- bind_rows(
  outage_group_CA  %>% mutate(State = "CA"),
  outage_group_TX  %>% mutate(State = "TX"),
  outage_group_FL  %>% mutate(State = "FL"),
  outage_group_PA  %>% mutate(State = "PA")
)

#summary stats 
state_summary <- all_states %>%
  group_by(State) %>%
  summarise(
    outage_count_range = paste0(min(outage_count), "–", max(outage_count)),
    outage_count_mean  = round(mean(outage_count, na.rm = TRUE), 2),
    
    outage_duration_range = paste0(min(max_outage_duration), "–", max(max_outage_duration)),
    outage_duration_mean  = round(mean(max_outage_duration, na.rm = TRUE), 2),
    
    customer_weighted_hours_range = paste0(min(customer_weighted_hours), "–", max(customer_weighted_hours)),
    customer_weighted_hours_mean  = round(mean(customer_weighted_hours, na.rm = TRUE), 2)) %>%
  arrange(State)   # alphabetical order

#table, align values in the center, fix column names, add commas 
kable(state_summary, booktabs = TRUE, align = "c", 
      col.names = c("State", 
                      linebreak("Outage Count\nRange", align = "c"),
                      linebreak("Outage Count\nMean", align = "c"),
                      linebreak("Max Duration\nRange", align = "c"),
                      linebreak("Max Duration\nMean", align = "c"),
                      linebreak("Customer Weighted\nHours Range", align = "c"),
                      linebreak("Customer Weighted\nHours Mean", align = "c")),
      escape = FALSE, #for header break formatting
      format.args = list(big.mark = ","))%>%
  kable_styling(latex_options = c("hold_position", "scale_down")) #shrinks table to fit page 
```

\newpage
# Exploratory Analysis 
The exploratory analysis of the data involved initial visualizations of the power outage counts for each state. For each state, a chart was created of power outages from 2015 to 2023 and another chart of power outages by month grouped by year. There was no missing data for any of the states during the time frame, and all outliers were retained because many reflect climate-driven extreme events relevant to our research. These exploratory trends informed the analytical methods used in this study. The presence of visual long-term increases in power outages motivated the use of the Mann–Kendall trend test, while the recurring monthly patterns suggested the need for seasonal decomposition and an ANOVA to test for significant seasonal variations.

### California
Initial data exploration of California power outage data suggest a slight increasing trend (Figure \@ref(fig:cayearly)). Furthermore, Figure \@ref(fig:camonthly) shows a clear increase in the number of outages every single month from 2015 to 2023. The monthly plot does not indicate that any particular month consistently experiences a higher number of power outages. 

```{r cayearly, fig.cap="Yearly plot of power outages in California from 2015 to 2023."}
# CA yearly plot 
CA_yearly <- outage_group_CA %>% 
  ggplot(
    mapping = aes(
      x= date,
      y = outage_count
      )) +
  geom_point(size = 2, alpha = 0.7)+
  geom_line()+
  geom_smooth(method ="lm", se = FALSE, color = "red") +
  labs(
    title = "Number of Power Outages in California from 2015 to 2023",
    y = "Number of Outages",
    x = "Year"
  )

CA_yearly
```

```{r camonthly, fig.cap="Monthly plot of power outages in California from 2015 to 2023."}
#CA monthly plot (for data visualization)
CA_monthly_plot <- outage_group_CA %>% 
  ggplot(
    mapping = aes(
      x=factor(
      month,
      levels=1:12,
      labels=month.abb),
      y = outage_count,
      color = factor(year))
    ) +
 geom_point(size = 2, alpha = 0.7)+
 scale_color_viridis(
   option = "mako", 
   direction = -1, 
   discrete = TRUE)+
  labs(
    title = "Number of Power Outages in California by Month from 2015 to 2023",
    y = "Number of Outages",
    x = "Month",
    color = "Year",
  )

CA_monthly_plot
```

\newpage
### Florida
In Florida, the number of outages shows a slight upward trend over the past decade (Figure \@ref(fig:flyearly)). On a monthly scale, outages consistently rise during the summer months, indicating a seasonal pattern likely driven by weather conditions or increased energy demand (Figure \@ref(fig:flmonthly)). However, when comparing month-to-month patterns across years, no clear year-to-year monthly trend emerges.

```{r flyearly, fig.cap = "Yearly plot of power outages in Florida from 2015 to 2023."}
#yearly_outages_FL <- outage_group_FL %>%
  #filter(month == 0)

yearly_outages_FL_plot <- ggplot(outage_group_FL, aes(x = date, y = outage_count)) +
  geom_line() + 
  geom_point() +
  geom_smooth(method="lm", se = FALSE, color = "darkgreen") +
  labs(title = "2015-2023 Yearly Outages for Florida",
       y="Outage Count",
       x="Year")

yearly_outages_FL_plot
```

```{r flmonthly, fig.cap="Monthly plot of power outages in Florida from 2015 to 2023."}
#monthly_outages_FL <- outage_group_FL %>%
  #filter(month != 0)

monthly_outages_FL_plot <- ggplot(outage_group_FL, 
                                  aes(x=factor(month, levels = 1:12, labels = month.abb), 
                                      y=outage_count, color = factor(year))) + 
  geom_point(size = 2, alpha = 0.7) +
  scale_colour_viridis(option = "mako", direction = -1, discrete = TRUE) +
  labs(title = "2015-2023 Monthly Outages for Florida",
       y="Outage Count",
       x="Date",
       color = "Year")

monthly_outages_FL_plot
```

\newpage
### Pennsylvania
From the initial data exploration of Pennsylvania, it is clear that power outages have gradually increased over the past decade (Figure \@ref(fig:payearly)). On a monthly basis, there is a noticeable rise in outages during the summer months, suggesting a seasonal pattern likely related to weather or energy demand (Figure \@ref(fig:pamonthly)). Overall, the data points to both long-term growth in the number of outages and predictable seasonal fluctuations.

```{r payearly, fig.cap="Yearly plot of power outages in Pennsylvania from 2015 to 2023."}
#Pennsylvania Yearly Power Outage
monthly_outages_PA <- outage_group_PA %>%
  mutate(
    year = year(date),
    month = month(date),
    year_month = as.Date(paste(year, month, "01", sep = "-"))
  ) %>%
  group_by(year_month) %>%
  summarise(outage_count = sum(outage_count))

ggplot(monthly_outages_PA, aes(x = year_month, y = outage_count)) +
  geom_point(size = 2, alpha = 0.7)+
  geom_line() +
  labs(
    title = "Number of Power Outages in Pennsylvania
    from 2015 to 2023",
    x = "Year", 
    y = "Number of Outages") +
  geom_smooth(method = "lm", se = FALSE, color = "purple")+
  theme(plot.title = element_text(hjust = 0.5))

```

```{r pamonthly, fig.cap= "Monthly plot of power outages in Pennsylvania from 2015-2023."}
#PA Monthly Power Outages
PA_monthly_plot <- outage_group_PA %>% 
  ggplot(aes(
    x = factor(month, levels = 1:12, labels = month.abb),
    y = outage_count,
    color = factor(year))) +
  geom_point(size = 2, alpha = 0.7) +
  scale_color_viridis(
    option = "mako", 
    direction = -1,
    discrete = TRUE) +
  labs(
    title = "Number of Power Outages in Pennsylvania\nby Month from 2015-2023",
    y = "Number of Outages",
    x = "Month",
    color = "Year" )

PA_monthly_plot
```

\newpage
### Texas
From this yearly plot of power outages in Texas from 2015 to 2023, we can observe a general increasing pattern of power outages between this time period, aside from the temporary drop between 2016-2018 (Figure \@ref(fig:txyearly)). By looking at this graph, we are also observing a pattern of spikes around May or the early summer months and could indicate a seasonal pattern (Figure \@ref(fig:txmonthly)). 

```{r txyearly, fig.cap="Yearly plot of power outages in Texas from 2015-2023."}
TX_outage_count <- ggplot(outage_group_TX,
                          aes(x = date,
                              y = outage_count))+
  geom_point(size = 2, alpha = 0.6)+
  geom_line()+
  geom_smooth(method = "lm", se = FALSE, color = "blue")+
  ylim(0,3000)+
  labs(title = "Number of Power Outages in Texas from 2015-2023",
       x = "Year",
       y="Number of Outages")

TX_outage_count
```

```{r txmonthly, fig.cap="Monthly plot of power outages in Texas from 2015 to 2023."}
TX_outage_count_month <- outage_group_TX %>% 
  ggplot(aes(x = factor(month,
                        levels=1:12,
                        labels=month.abb),
                             y = outage_count,
                             color = factor(year)))+
  geom_point(size = 2, alpha = 0.7)+
  scale_colour_viridis(option = "mako", direction = -1, discrete = TRUE)+
  labs(title = "Number of Power Outages in Texas by Month from 2015-2023",
       x = "Month",
       y="Number of Outages", 
       color = "Year")

print(TX_outage_count_month)
```

\newpage
# Analysis
The power outage datasets for each state were analyzed by creating time series objects of the power outage count data. The time series objects were decomposed to separate the trend, seasonality, and remainder. New data frames were created with these three time series components. A non-seasonal power outage count component was created by subtracting the seasonal component from the trend and remainder components. This nonseasonal components was graphed along with the observed power outage count to display the visual fit of the trend. Mann-Kendall tests were performed on the nonseasonal component to statistically analyze the trends, providing the trend direction and statistical significance. 

The seasonal component was isolated and graphed by grouping the yearly values (2015-2023) by month. This shows how the seasonal component changes over the year, allowing for the months with a high count of power outages to be identified. To statistically analyze the seasonality of power outages, a one-way ANOVA test was performed to see if power outage counts varied significantly across months.

To investigate the severity of power outages, time series objects were created of the customer weighted hours data. The customer weighted hours’ time series objects were also decomposed to separate the trend, seasonality, and remainder of each dataset. A non-seasonal power outage count component was created by subtracting the seasonal component from the trend and remainder components. This nonseasonal components was graphed along with the observed customer weighted hours to display the visual fit of the trend. Mann-Kenndall tests were performed on the nonseasonal component to statistically analyze the trends, providing the trend direction and statistical significance.

## Question 1: How has the number of power outages changed over time?
### California 

Figure \@ref(fig:CAtimeseries) displays the decomposed time series of the number of power outages in California from 2015 to 2023. There appears to be clear seasonal trend, which is analyzed further in Section \@ref(sec-questwo). 

A MannKendall non-seasonal trend analysis was applied to the California power outage count dataset with the seasonal component removed, a significant overall increase in power outages over time is observed (MannKendall; tau = 5.437e-01, p < 2.2e-16). This supports the hypothesis that the number of power outages are increasing. Figure \@ref(fig:CAtrend) visualizes the trend compared to the observed number of power outages in California. The red line represents the overall increasing trend.

```{r CAtimeseries, fig.cap="Decomposed components of the California power outage count time series."}
#define first day and first year values 
f_month <- month(first(outage_group_CA$date))
f_year <- year(first(outage_group_CA$date))

#create time series object 
CA_outage_ts <- 
  ts(outage_group_CA$outage_count, 
     start = c(f_year, f_month), 
     frequency = 12)

#decompose and plot
CA_outage_decompose <- stl(CA_outage_ts, 
                           s.window = "periodic")
plot(CA_outage_decompose)

```

```{r CA trend analysis chunk, include=FALSE}
#run monotonic trend analysis, i think this should be removed and just focus on non seas analysis

#CA_outage_trend <- trend::smk.test(CA_outage_ts)
#CA_outage_trend
#summary(CA_outage_trend)

#remove seasonality trend?? and re=run MK test 
#extract the components of each series into a df
CA_outage_compon <- 
  as.data.frame(CA_outage_decompose$time.series[,1:3])

#remove seasonal 
CA_outage_non_seas <- 
  CA_outage_ts - CA_outage_compon[,1]

#rerun MK
CA_outage_trend_noseasons <- trend::mk.test(CA_outage_non_seas)
CA_outage_trend_noseasons

#results:
#data:  CA_outage_non_seas
#z = 8.3362, n = 108, p-value < 2.2e-16
#    S         varS          tau 
#3.141000e+03 1.418810e+05 5.436608e-01 

```

```{r CAtrend, echo=FALSE, fig.cap="Trend versus observation of power outages in California (2015-2023)."}
#adding three new columns, observed outages, month date
CA_outage_components <- mutate(CA_outage_compon,
        Observed = outage_group_CA$outage_count, 
        Month = outage_group_CA$month,
        Date = outage_group_CA$date)

# Visualize how the trend maps onto the data
outage_trend_vis_CA <- ggplot(CA_outage_components) +
  geom_line(aes(y = Observed, x = Date),  size = 0.25) + #observed component
  geom_line(aes(y = trend, x = Date), color = "red") + #trend component (red)
  geom_hline(yintercept = 0, lty = 2) + 
  labs(y = "Number of outages",
      title = "Trend Component of California Power Outages Compared to the Observed Data")

outage_trend_vis_CA
```

\newpage
### Florida 
Figure \@ref(fig:FLtimeseries) shows the time series analysis for outage occurrences across Florida from 2015 to 2023. While a clear pattern of seasonality is evident within the time series, applying a non-seasonal Mann-Kendall test will determine if outage count across the years has a significant trend. The results of the test confirm that there is a statistically significant increase in outages in Florida (tau = 2.426865e-01, p = 0.0001997), independent from seasonality changes. Figure \@ref(fig:FLdecomp) shows the increasing trend.

```{r FLtimeseries, fig.cap="Decomposed components of the Florida power outage count time series."}
# Time Series Analysis for FL Monthly Outage Count
first_month_FL <- month(first(outage_group_FL$date))
first_year_FL <- year(first(outage_group_FL$date))

monthly_outages_FL.ts <- ts(outage_group_FL$outage_count, 
                             frequency = 12, start = c(first_year_FL, first_month_FL))

# TS trend analysis
FL_monthly_decomposed <- stl(monthly_outages_FL.ts, s.window = "periodic")
plot(FL_monthly_decomposed, main = "Time Series Analysis for Monthly FL Outages")

```

```{r FLdecomp, fig.cap = "Trend versus observation of power outages in Florida (2015-2023)"}
monthly_outages_FL.components <- as.data.frame(FL_monthly_decomposed$time.series[,1:3])

monthly_outages_FL.components <- mutate(monthly_outages_FL.components,
        Observed = outage_group_FL$outage_count,     
        Date = outage_group_FL$date)

# Trend Plot
fl_trend_plot <- ggplot(monthly_outages_FL.components) +
  geom_line(aes(y = Observed, x = Date),  linewidth = 0.5) +
  geom_line(aes(y = trend, x = Date), color = "darkgreen") +
  labs(
    y = "Outage Count", 
    title = "Trend Component of Florida Power Outages
      Compared to the Observed Data")
#plot
fl_trend_plot
```

```{r FLnonseasonal, fig.cap="FL Nonseasonal Trend Analysis for Monthly Outages", include=FALSE}
#Non-Seasonal Trend Analysis for FL
monthly_outages_FL_nonseasonal <- monthly_outages_FL.ts - monthly_outages_FL.components[,1]

FL_nonseasonal_outage_trend <- trend::mk.test(monthly_outages_FL_nonseasonal)
FL_nonseasonal_outage_trend

summary(FL_nonseasonal_outage_trend)
```

\newpage
### Pennsylvania 
After removing the seasonal component from the Pennsylvania outage time series, the Mann–Kendall trend test revealed a significant positive trend (z = 3.02, n = 108, p = 0.002), indicating that the number of outage has increased slightly from 2015 to 2023. This result supports the hypothesis that outages have become more common during this time, independent of seasonal patterns. The decomposed time-series visualization shows this trend clearly, revealing that even after accounting for monthly fluctuations, the long-term component continues to rise (Figure \@ref(fig:PAtimeseries)). Figure \@ref(fig:PAtrend) reveals the trend of the power outages with the seasonality element removed compared to the observed data. 

```{r PAtimeseries, fig.cap="Decomposed components of the Pennsylvania power outage count time series."}
# Aggregate monthly
monthly_outages_PA <- outage_group_PA %>%
  mutate(
    year = year(date),
    month = month(date),
    year_month = as.Date(paste(year, month, "01", sep = "-"))
  ) %>%
  group_by(year_month) %>%
  summarise(outage_count = sum(outage_count))

# Create time series object
Outages_ts_PA <- ts(monthly_outages_PA$outage_count, 
                    start = c(2015,1), end =c(2023,12), frequency = 12)

#Visualize Decomposed Series
Outage_Decomposed_PA <- stl(Outages_ts_PA, s.window = "periodic")

plot(Outage_Decomposed_PA)

```

```{r warning=TRUE, include=FALSE}
#Mann-Kendall Seasonality Test
Outages_PA_SMK <- Kendall::SeasonalMannKendall(Outages_ts_PA)
Outages_PA_SMK
summary(Outages_PA_SMK)
#p-value is 0.009

#Extracting components into Data Frame
Outage_components_PA<-as.data.frame(Outage_Decomposed_PA$time.series[,1:3])

Outage_components_PA <- mutate(Outage_components_PA,
        Observed = monthly_outages_PA$outage_count, 
        Month = outage_group_PA$month,
        Date = monthly_outages_PA$year_month)

#Mann-Kendall Seasonality Test
Outages_PA_SMK <- Kendall::SeasonalMannKendall(Outages_ts_PA)
Outages_PA_SMK
summary(Outages_PA_SMK)
#p-value is 0.009

#Remove Seasonal
PA_outage_non_seas <- Outages_ts_PA - Outage_components_PA$seasonal

PA_outage_MK_noseason <- trend::mk.test(PA_outage_non_seas)
PA_outage_MK_noseason
#p-value is 0.002
```

```{r PAtrend, fig.cap="Trend versus observation of power outages in Pennsylvania (2015-2023)."}
#Visualize the trends
ggplot(Outage_components_PA)+
  geom_line(aes(y = Observed, x = Date),  size = 0.25) +
  geom_line(aes(y = trend, x = Date), color = "purple") +
  geom_hline(yintercept = 0, lty = 2) +
 labs(y = "# of outages",
      title = "Trend Component of Pennsylvania Power Outages
      Compared to the Observed Data")+
  theme(plot.title = element_text(hjust = 0.5))

```

\newpage
### Texas 
Figure \@ref(fig:txtimeseries) shows the decomposed components of the Texas power outage count time series from 2015–2023. With a very small p-value (2.22e-16), the result indicates an upward trend, and it is statistically significant. After removing the seasonal component and rerunning the test, the Mann–Kendall results (z = 9.9423, n = 108, p-value < 2.2e-16) still show a highly significant positive trend. This confirms our earlier visualization that the increase in outage counts persists even after accounting for the influence of seasonal weather patterns. Figure \@ref(fig:TXtrend) shows the overall trend without seasonality of power outages in Texas compared to the observed data. 

```{r txtimeseries, fig.cap="Decomposed components of the Texas power outage count time series."}
#time series object
TXOutage_count_ts <- ts(outage_group_TX$outage_count, 
                      start = c(2015,1), 
                      end = c(2023, 12),
                      frequency = 12)

# Generate the decomposition
TXOutage_count_Decomposed <- stl(TXOutage_count_ts, s.window = "periodic")
# Visualize the decomposed series. 
plot(TXOutage_count_Decomposed)
```

```{r warning=TRUE, include=FALSE}
# Extract the components and turn them into data frames
TXOutage_count_Components <- as.data.frame(TXOutage_count_Decomposed$time.series[,1:3])

TXOutage_count_Components <- mutate(TXOutage_count_Components,
        Observed = outage_group_TX$outage_count, 
        Month = outage_group_TX$month,
        Date = outage_group_TX$date)

#Mann-Kendall Seasonality Test
TX_outages_SMK <- Kendall::SeasonalMannKendall(TXOutage_count_ts)
TX_outages_SMK
summary(TX_outages_SMK)

#tau = 0.727, 2-sided pvalue =2.22e-16

#Remove Seasonal and run the MK test again
TX_outages_noseas <- TXOutage_count_ts - TXOutage_count_Components$seasonal
TX_outages_nonseason <- trend::mk.test(TX_outages_noseas)
TX_outages_nonseason

#data:  TX_outages_nonseason
#z = 9.9423, n = 108, p-value < 2.2e-16
```


```{r TXtrend, fig.cap="Trend versus observation of power outages in Texas (2015-2023)."}

# Visualize how the trend maps onto the data
ggplot(TXOutage_count_Components) +
  geom_line(aes(y = Observed, x = Date),  size = 0.25) +
  geom_line(aes(y = trend, x = Date), color = "blue") +
  geom_hline(yintercept = 0, lty = 2)+
  ylim(-100,3000)+
  labs(title = "Trend Component of the Texas Power Outage ",
       x = "Year",
       y=" Number of Outages ")
```

\newpage
### Comparision between States

Figure \@ref(fig:nonseasall) visualizes each state’s non-seasonal power outage time series trend. Red represents California, green is Florida, purple is Pennsylvania, and blue is Texas. All states are seeing a significant increasing trend of power outages, this confirmed both visually and through each state's Mann–Kendall results (CA: p < 2.2e-16, FL: p = 0.0001997, PA: p = 0.002, TX: p < 2.2e-16). These results supports our first hypothesis that power ouotages are becoming more frequent. California and Texas are experiencing the greatest increase, while Pennsylvania and Florida are experiencing more gradual increases in comparison. Towards the end of the time period, California and Texas also overall have more power outages than Florida and Pennsylvania, with Pennsylvania seeing overall the lowest amount of power outages. 

```{r nonseasall, fig.cap="Non-seasonal trend of power outages in California, Florida, Pennsylvania, and Texas."}
# Add a column for states 
CA_nonseas_combined <- CA_outage_components %>%
  mutate(State = "CA",
         nonseas = trend + remainder)

PA_nonseas_combined <- Outage_components_PA %>%
  mutate(State = "PA", 
         nonseas = trend + remainder)

TX_nonseas_combined <- TXOutage_count_Components %>%
  mutate(State = "TX", 
         nonseas = trend + remainder,
         Month= as.numeric(outage_group_TX$month))

FL_nonseas_combined <- monthly_outages_FL.components %>%
  mutate(State = "FL",
         nonseas = trend + remainder)

# Combine the datasets
nonseas_combined_data <- bind_rows(CA_nonseas_combined, PA_nonseas_combined, TX_nonseas_combined, FL_nonseas_combined)

nonseas_combined <- nonseas_combined_data %>% 
  ggplot(
    aes(
      x = Date,
      y = nonseas,
      color = State)) +
  geom_point(size = 1.5, alpha = 0.5)+
  geom_smooth(method ="lm", se = FALSE, size = 1.5) +
  labs(
    x = "Year",
    y = "Number of outages",
    title = "Non-Seasonal Trend of Power Outages") +
  scale_color_manual(values = c(
  "CA" = "red",
  "PA" = "purple",
  "TX" = "blue",
  "FL" = "darkgreen"))

nonseas_combined
```

\newpage
## Question 2: Is there a seasonal trend? Are certain months more prone to outages? {#sec-questwo}
### California 

Figure \@ref(fig:CAtimeseries) displays a clear seasonal pattern in the decomposed time series of the number of power outages in California. The seasonal component was isolated and grouped by year to show the seasonal cycle of power outages in California in Figure \@ref(fig:CAseasonal). The seasonal cycle highlights a potential pattern of power outage counts rising in the summer months, peaking in October. However, despite the visual pattern, the number of power outages in California was not significantly different among the months (ANOVA; df = 11, F = 0.704, p = 0.732). This result does not support the second hypothesis that each state has distinct seasonal power outage patterns related to its dominant weather hazards.

```{r CAseasonal, fig.cap="Seasonal component of the California power outage time series analysis where yearly data is grouped by month.", fig.align='center'}
#visualize grouped by month
outage_seas_month_vis_CA <- ggplot(CA_outage_components) +
  geom_line(aes(y = seasonal, 
                x=factor(
                  Month,
                  levels=1:12,
                  labels=month.abb), 
                group = year(Date)), 
                color = "red") +
  geom_hline(yintercept = 0, lty = 2) +
  labs(x = "Month", 
       y = "# of outages",
       title = "Seasonal Cycle of Power Outages in California")

outage_seas_month_vis_CA

```

```{r CA seasonal anova, include=FALSE}
#testing: “Are outage counts significantly different across months?”
outage_group_CA$month <- factor(month(outage_group_CA$date),
                                levels = 1:12,
                                labels = month.abb)

CA_anova_outage <- aov(data = outage_group_CA, outage_count ~ month)
summary(CA_anova_outage)

#show months
TukeyHSD(CA_anova_outage)

#results:
#Df   Sum Sq Mean Sq F value Pr(>F)
#month       11  1284083  116735   0.704  0.732
#Residuals   96 15923546  165870  
#The frequency of outages in California was not significantly different among the months (ANOVA; df = 11, F = 0.704, p < 0.732.  

```

\newpage
### Florida 
Results from the time series for outages in FL displayed a pattern of seasonality. To further analyze the strength of that trend, months of every year were aggregated to show a cumulative trend across 2015 to 2023 in Figure \@ref(fig:FLseasonal). A clear normal distribution shows a concentration of outage occurrences in summer months, and a significant decline in winter months. The June to September seasonal peak coincides with the Atlantic Hurricane season. An ANOVA test statistically confirms that outage counts between months vary significantly, following a seasonal trend (Df = 11, F-value = 43.28, p < 2e-16). This supports the second hypothesis that each state has distinct seasonal power outage patterns related to its dominant weather hazards.

```{r FLseasonal, fig.cap = "Seasonal component of the Florida power outage time series analysis where yearly data is grouped by month."}
ggplot(monthly_outages_FL.components) +
  geom_line(aes(x = factor(month(Date), levels = 1:12, labels = month.abb), 
                y= seasonal,
                group = year(Date)), 
                color = "darkgreen") + 
  geom_hline(yintercept = 0) + 
  labs(title = "Seasonal Cycle of Power Outages in Florida",
       x = "Month", y = "Outage Count")
```


```{r FL seasonal ANOVA, include=FALSE}
##Are outage counts significantly different across months?
##Null Hypothesis: Mean outage counts are the same for all 12 months 
##Alt Hypothesis: At least on month differs (Seasonality)

#format outage group month as factor 
outage_group_FL$month <- factor(month(outage_group_FL$date),
                                levels = 1:12,
                                labels = month.abb)
#run anova
FL_anova_outage <- aov(data = outage_group_FL, outage_count ~ month)
summary(FL_anova_outage)

#show months
TukeyHSD(FL_anova_outage)


##The frequency of outages in Florida was significantly different among the months (ANOVA; df = 11, F = 43.28, p < 2e-16. This supports our alternative hypothesis that outages are not evenly distributed throughout the year but instead follow a seasonal pattern. 
```


\newpage
### Pennsylvania 
The Mann–Kendall seasonal trend test for Pennsylvania outage counts indicated a significant seasonal signal in the data (tau = 0.20, p = 0.009), demonstrating that outage frequencies vary across months. This finding supports the hypothesis that outages are not evenly distributed throughout the year but instead follow a seasonal pattern. The visualizations further highlight this pattern, showing clear peaks in June, July, and August, when outage counts are highest (Figure \@ref(fig:PAseasonal)). Together, these results suggest that summer months consistently experience elevated outage activity, potentially driven by seasonal weather conditions or increased energy demand. The number of outages in Pennsylvania was significantly different among the months (ANOVA; df = 11, F =12.1, p < 7.54e-15). This supports our alternative hypothesis that outages are not evenly distributed throughout the year but instead follow a seasonal pattern. 

```{r fullseascycle, fig.cap="Isolated seasonal component of PA power outages."}
#Visualize seasonal Component 
#ggplot(Outage_components_PA) +
#  geom_line(aes(x = Date, y = seasonal), color = "purple") +
#  geom_hline(yintercept = 0) +
#   labs(y = "# of outages",
#      title = "Trend Component of Pennsylvania Power Outages
#      Compared to the Raw Data")+

#Outage_components_PA$Month <- month(Outage_components_PA$Date)

```

```{r PAseasonal, fig.cap="Seasonal component of the Pennsylvania power outage time series analysis where yearly data is grouped by month."}

#seasonal by month
ggplot(Outage_components_PA) +
  geom_line(aes(
    x = factor(Month, levels = 1:12, labels = month.abb),
    y = seasonal,
    group = year(Date)
  ), color = "purple") +
  geom_hline(yintercept = 0) +
  labs(x = "Month", y = "# of outages",
  title = "Seasonal Cycle of Outages in Pennsylvania")+
  theme(plot.title = element_text(hjust = 0.5))

```

```{r PA seasonal ANOVA, include=FALSE}
##Are outage counts significantly different across months?
##Null Hypothesis: Mean outage counts are the same for all 12 months 
##Alt Hypothesis: At least on month differs (Seasonality)

#format outage group month as factor 
outage_group_PA$month <- factor(month(outage_group_PA$date),
                                levels = 1:12,
                                labels = month.abb)
#run anova
PA_anova_outage <- aov(data = outage_group_PA, outage_count ~ month)
summary(PA_anova_outage)

#show months
TukeyHSD(PA_anova_outage)

##The frequency of outages in Pennsylvania was significantly different among the months (ANOVA; df = 11, F =12.1, p < 7.54e-15. This supports our alternative hypothesis that outages are not evenly distributed throughout the year but instead follow a seasonal pattern.  

```

\newpage
### Texas 
By observing Figure \@ref(fig:TXseasonal) alone, there's a visible seasonal trend with a sudden peak in May. However, after running an ANOVA test, the results (df = 11, F = 1.215, p = 0.288) shows a high p-value (>0.05). This result suggests that despite the peak in May in Figure \@ref(fig:TXseasonal), the number of Texas power outages during 2015-2023 was not significantly different between different months based on outage counts alone.

```{r TXseasonal, fig.cap="Seasonality component of the Texas power outage count time series analysis where yearly data is grouped by month."}
# Visualize how the seasonal cycle maps onto the data
ggplot(TXOutage_count_Components) +
  geom_line(aes(y = seasonal, 
                x=factor(Month, levels=1:12, labels=month.abb), 
                group = year(Date)), 
                color = "blue") +
  geom_hline(yintercept = 0, lty = 2) +
  labs(x = "Month", 
       y = "# of outages",
       title = "Seasonality of Power Outages in Texas")
```

```{r TX seasonal ANOVA, include=FALSE}
##Are outage counts significantly different across months?
##Null Hypothesis: Mean outage counts are the same for all 12 months 
##Alt Hypothesis: At least on month differs (Seasonality)
#format month as factor
outage_group_TX$month <- factor(month(outage_group_TX$date),
                                levels = 1:12,
                                labels = month.abb)

#run anova
TX_anova_outage <- aov(data = outage_group_TX, outage_count ~ month)
summary(TX_anova_outage)

#show months
TukeyHSD(TX_anova_outage)

#despite visual appearances of a trend, with power outages peaking in May...
#The frequency of outages in Texas was not significantly different among the months (ANOVA; df = 11, F = 1.215, p < 0.288).  

```


\newpage
### Comparision between States

Figure \@ref(fig:seasall) displays the seasonal cycle for each state. This was created by aggregating the monthly power outage data of every year to show cumulative trend across 2015 to 2023. Florida and Pennsylvania have very similar seasonal patterns, with a outages concentrated in the summer months (peaking in July), and declining sharply in the winter months. Texas appears to peak earlier in May, while California has a less discernible trend, with a peak in October. 

ANOVA tests show that California and Texas both have high p-values (CA: p < 0.732, TX: p<0.288), suggesting that there's no seasonal trend in the number of power outages in these two states. However for Florida and Pennsylvania, the ANOVA results (FL: p < 2e-16, PA: p < 7.54e-15) suggest a seasonal pattern in power outages.  

These results provide partial support for our second hypothesis. Florida and Pennsylvania clearly demonstrate seasonal outage patterns linked to their dominant weather hazards, while California and Texas do not show significant seasonality. Further analysis is needed to quantify the relationship between climate-related extreme events and power outages.

```{r seasall, fig.cap="Seasonal cycle of power outages in California, Florida, Pennsylvania, and Texas (2015-2023 combined)."}
#Seasonal Cycle combined
# Add a column for states () Need to add FL and TX)
CA_outage_combined <- CA_outage_components %>%
  mutate(State = "CA")

PA_Outage_combined <- Outage_components_PA %>%
  mutate(State = "PA")

TX_Outage_combined <- TXOutage_count_Components %>%
  mutate(State = "TX",
         Month = as.numeric(outage_group_TX$month))

FL_Outage_combined <- monthly_outages_FL.components %>%
  mutate(State = "FL",
         Month = as.numeric(outage_group_FL$month))

# Combine the datasets
combined_data <- bind_rows(CA_outage_combined, PA_Outage_combined, TX_Outage_combined, FL_Outage_combined)

# Plot together
ggplot(combined_data) +
  geom_line(aes(
    x = factor(Month, levels = 1:12, labels = month.abb),
    y = seasonal,
    group = interaction(year(Date), State),
    color = State)) +
  geom_hline(yintercept = 0) +
  labs(
    x = "Month",
    y = "# of outages",
    title = "Seasonal Cycle of Power Outages") +
  scale_color_manual(values = c(
  "CA" = "red",
  "PA" = "purple",
  "TX" = "blue",
  "FL" = "darkgreen"
))

```

\newpage
## Question 3: How has the severity of power outages changed over time?  
### California 
Figure \@ref(fig:CAcwh) displays the decomposed time series of the California customer weighted hours from 2015 to 2023. After removing the seasonality component the Mann-Kendall trend test suggests that there is a significant increase in the overall customer weighted hours of power outages in California (MannKendall; tau 3.513e-01 = p < 7.178e-08), and thus supporting the third hypothesis that the severity of power outages is increasing. 

Of note is that the customer weighted outage hours appears to be dominated by infrequent extreme weather events. In California there are clear spikes that correlate with extreme events, such as the 2019 Public Safety Power Shutoffs conducted by California PG&E to prevent wildfire during strong windstorms, and Atmospheric River events in early 2023 (Maxouris, 2019; NASA, 2023). Future analysis should graph customer weighted hours with these events to present the correlation.

```{r CAcwh, fig.cap="Decomposed trend of customer weighted outage time in California"}
#create time series object 
CA_CWA_ts <- 
  ts(outage_group_CA$customer_weighted_hours, 
     start = c(f_year, f_month), 
     frequency = 12)

#decompose and plot
CA_CWA_decompose <- stl(CA_CWA_ts, 
                           s.window = "periodic")
plot(CA_CWA_decompose)

```

```{r CA trend analysis hide output, include=FALSE}
#run monotonic trend analysis (don't include)
#CA_CWA_trend <- trend::smk.test(CA_CWA_ts)
#CA_CWA_trend

#summary(CA_CWA_trend)

#remove seasonality for customer weighted average
#extract the components of each series into a df
CA_CWA_compon <- 
  as.data.frame(CA_CWA_decompose$time.series[,1:3])

#remove seasonal 
CA_CWA_non_seas <- 
  CA_CWA_ts - CA_CWA_compon[,1]

#run MK test
CA_cwh_trend_noseasons <- trend::mk.test(CA_CWA_non_seas)
CA_cwh_trend_noseasons
#tau = 3.513e-01 p < 7.178e-08

#adding three new columns, observed outages, month date
CA_cwh_outage_components <- mutate(CA_CWA_compon,
        Observed = outage_group_CA$customer_weighted_hours, 
        Month = outage_group_CA$month,
        Date = outage_group_CA$date)

```

```{r CAcwhtrend, fig.cap="Trend versus observation of customer weighted hours in California (2015-2023)."}
# Visualize how the trend maps onto the data
cwh_trend_vis_CA <- ggplot(CA_cwh_outage_components) +
  geom_line(aes(y = Observed, x = Date),  size = 0.25) + #observed component
  geom_line(aes(y = trend, x = Date), color = "red") + #trend component (red)
  geom_hline(yintercept = 0, lty = 2) + 
  labs(y = "Number of outages",
      title = "Trend Component of California Power Outages Compared to the Observed Data")

cwh_trend_vis_CA

```


\newpage
### Florida 
Figure \@ref(fig:FLcwh) visualizes the time series analysis for customer weighted hours in Florida from 2015 to 2023. The results of the non-seasonal Mann-Kendall test returned a non-significant increasing trend in customer weighted duration (tau = 7.961e-02 p-value = 0.223). This does not support the third hypothesis that power outages are increasing in severity. The customer weighted hours dataset appears to be dominated by extreme weather events. For example, there is a big peak in later 2017, which coincides with Hurricane Irma which impacted 64% of customers in the state (EIA, 2017). Additionally, there is another peak in late 2022, which coincides with Hurricane Ian which also caused wide-spread power outages (NASA, 2022). 

```{r FLcwh, fig.cap = "Decomposed trend of customer weighted outage time in Florida."}
# customer weighted hours = customer hours x duration

monthly_wHrs_FL.ts <- ts(outage_group_FL$customer_weighted_hours, 
                             frequency = 12, start = c(first_year_FL, first_month_FL))

# Decomposition and Plot
FL_wHrs_decomposed <- stl(monthly_wHrs_FL.ts, s.window = "periodic")
plot(FL_wHrs_decomposed, main = "Time Series Analysis for Monthly FL Customer Weighted Hours")
```

```{r FL Trend Analysis, include=FALSE}
monthly_wHrs_FL.components <- as.data.frame(FL_wHrs_decomposed$time.series[,1:3])

monthly_wHrs_FL.components <- mutate(monthly_wHrs_FL.components,
        Observed = outage_group_FL$customer_weighted_hours,     
        Date = outage_group_FL$date)

# FL Customer Weighted Average Mann-Kendall Seasonal Trend Analysis
FL_monthly_CWH_trend <- trend::smk.test(monthly_wHrs_FL.ts)
FL_monthly_CWH_trend

summary(FL_monthly_CWH_trend)

# FL Customer Weighted Average Non-Seasonal Trend Analysis
FL_monthly_CWH_nonseasonal <- monthly_wHrs_FL.ts - monthly_wHrs_FL.components[,1]

FL_nonseasonal_CWH_trend <- trend::mk.test(FL_monthly_CWH_nonseasonal)
FL_nonseasonal_CWH_trend

summary(FL_nonseasonal_CWH_trend)
```

```{r FLcwhTrend, fig.cap = "Trend versus observation of customer weighted hours in Florida (2015-2023)"}
ggplot(monthly_wHrs_FL.components) +
  geom_line(aes(y = Observed, x = Date)) +
  geom_line(aes(y = trend, x = Date), color = "darkgreen", size = 1) +
  labs(title = "Observed vs. Trend in Customer Weighted Hours (FL)") +
  ylab("Customer Weighted Hours") +
  xlab("Date") +
  geom_hline(yintercept = 0)
```

```{r FLcwhSeasonal, eval=FALSE, fig.cap="FL Seasonal Analysis for Customer Weighted Hours.", include=FALSE}
#set to no ouput, think we should just focus on the trend not seasonal 
ggplot(monthly_wHrs_FL.components) +
  geom_line(aes(x = factor(month(Date), levels = 1:12, labels = month.abb), 
                y= seasonal,
                group = year(Date)), 
                color = "darkgreen") + 
  geom_hline(yintercept = 0) + 
  labs(title = "Seasonal Cycle of Customer Weighted Duration in Florida",
       x = "Month", y = "Customer Weighted Duration")
```


\newpage
### Pennsylvania 
For customer-weighted hours, the seasonal test was not statistically significant (tau = 0.13, p = 0.09), indicating no consistent monthly pattern in outage impacts on customers. However, after de-seasonalizing, the Mann-Kendall trend test suggested a marginally increasing trend in customer-weighted hours over time (z = 1.89, n = 108, p = 0.06). Overall, these results suggest that while outage counts are increasing and show clear seasonality, the impact on customers is also trending upward, though less strongly (Figure \@ref(fig:PAcwh)). Figure \@ref(fig:PAcwhTrend) shows that the upward non-seasonal trend is very slight. 

```{r PAcwh, fig.cap = "Decomposed trend of customer weighted outage time in Pennsylvania."}
# Aggregate monthly
monthly_cwh_PA <- outage_group_PA %>%
  mutate(
    year = year(date),
    month = month(date),
    year_month = as.Date(paste(year, month, "01", sep = "-"))) %>%
  group_by(year_month) %>%
  summarise(customer_weighted_hours = sum(customer_weighted_hours, na.rm = TRUE))

# Create time series object
CWH_ts_PA <- ts(
  monthly_cwh_PA$customer_weighted_hours,
  start = c(2015,1), end =c(2023,12), frequency = 12)

# Visualize Decomposed series
CWH_decompose_PA <- stl(CWH_ts_PA, s.window = "periodic")
plot(CWH_decompose_PA)

#Extracting components into Data Frame
CWH_components_PA <- as.data.frame(CWH_decompose_PA$time.series[,1:3]) %>%
  mutate(Observed = monthly_cwh_PA$customer_weighted_hours,
    Date = monthly_cwh_PA$year_month,
    Month = month(Date))
```

```{r eval=FALSE, include=FALSE}
#Mann-Kendall Seasonality Test
CWH_PA_SMK <- Kendall::SeasonalMannKendall(CWH_ts_PA)
CWH_PA_SMK
summary(CWH_PA_SMK)
#p-value= 0.09

#Remove Seasonal
CWH_non_seas_PA <- CWH_ts_PA - CWH_components_PA$seasonal
CWH_MK_noseason_PA <- trend::mk.test(CWH_non_seas_PA)
CWH_MK_noseason_PA
#p-value=0.06
```

```{r PAcwhTrend, fig.cap = "Trend versus observation of customer-weighted hours in PA (2015-2023)."}
#Visualize the trends
ggplot(CWH_components_PA) +
  geom_line(aes(x = Date, y = Observed)) +
  geom_line(aes(x = Date, y = trend), color = "purple") +
  labs(x = "Date", y = "Customer Weighted Hours",
  title = "Observed vs Trend in
  Customer-Weighted Hours (PA)") +
  geom_hline(yintercept = 0)+
  theme(plot.title = element_text(hjust = 0.5))
```

```{r PAcwhSeas, eval=FALSE, fig.cap="Single year breakdown of seasonal component of customer-weighted hours in PA.", include=FALSE}
#set to no output to focus on overall trend
# Seasonal Cycle by Month
ggplot(CWH_components_PA) +
  geom_line(aes(
    x = factor(Month, levels = 1:12, labels = month.abb),
    y = seasonal,
    group = year(Date)
  ), color = "purple") +
  geom_hline(yintercept = 0) +
  labs(x = "Month", y = "Seasonal Component",
  title = "Seasonal Cycle of Customer-Weighted Hours (PA)")+
  theme(plot.title = element_text(hjust = 0.5))
```

\newpage
### Texas 
Figure \@ref(fig:txtimeseriesweighted) shows the decomposed components of the Texas customer weighted outage hours time series from 2015–2023. A Mann–Kendall tau of 0.505 indicates a strong positive monotonic trend even in the presence of seasonality. With a very small p-value (5.34×10⁻¹¹), this upward trend is statistically significant. After removing the seasonal component and rerunning the test, the Mann–Kendall results (z = 5.03, n = 108, p-value = 4.88×10⁻⁷) still show a highly significant positive trend in customer weighted outage hours. 

```{r txtimeseriesweighted, fig.cap="Decomposed trend of customer weighted outage time in Texas"}
#time series object
TX_CWH_ts <- ts(outage_group_TX$customer_weighted_hours, 
                      start = c(2015,1), 
                      end = c(2023, 12),
                      frequency = 12)

# Generate the decomposition
TX_CWH_ts_Decomposed <- stl(TX_CWH_ts, s.window = "periodic")
# Visualize the decomposed series. 
plot(TX_CWH_ts_Decomposed)
```


```{r TXCWHtrend, fig.cap="Trend versus observation of customer weighted hours in Texas (2015-2023)."}
# Extract the components and turn them into data frames
TX_CWH_Components <- as.data.frame(TX_CWH_ts_Decomposed$time.series[,1:3]) %>% 
  mutate(
        Observed = outage_group_TX$customer_weighted_hours, 
        Month = outage_group_TX$month,
        Date = outage_group_TX$date)

# Visualize how the trend maps onto the data
ggplot(TX_CWH_Components) +
  geom_line(aes(y = Observed, x = Date),  size = 0.25) +
  geom_line(aes(y = trend, x = Date), color = "blue") +
  geom_hline(yintercept = 0, lty = 2)+
  labs(title = "Trend versus observation of power outages in Texas (2015-2023)",
       x = "Year",
       y=" Number of Outages ")

```


```{r include=FALSE}
#Mann-Kendall Seasonality Test
TX_CWH_SMK <- Kendall::SeasonalMannKendall(TX_CWH_ts)
TX_CWH_SMK
summary(TX_CWH_SMK)

#p-value = 5.3438e-11

#Remove Seasonal
#p-value = 4.882e-07, tau = 3.281412e-01
TX_CWH_noseas <- TX_CWH_ts - TX_CWH_Components$seasonal
TX_CWH_nonseason <- trend::mk.test(TX_CWH_noseas)
TX_CWH_nonseason
```

```{r TXCWHseason, eval=FALSE, fig.cap="Seasonal component of customer weighted outage hours in Texas", include=FALSE}
#set to no output to focus on overall trend
# Visualize how the seasonal cycle maps onto the data
ggplot(TX_CWH_Components) +
  geom_line(aes(y = seasonal, 
                x=factor(Month, levels=month.abb, labels=month.abb), 
                group = year(Date)), 
                color = "blue") +
  geom_hline(yintercept = 0, lty = 2) +
  labs(x = "Month", 
       y = "# of outages",
       title = "Seasonality of Customer Weighted Outages Hours in Texas, 2015-2023")
```

\newpage
### Comparison between States
This plot shows the non-seasonal pattern of customer-weighted outage hours for four states from 2015–2023 (Figure \@ref(fig:cwhall)). Overall, California and Texas both show a similar strong upward trends, indicating that total customer-weighted outage has increased intensely since 2015. The rise in outage hours for California could be a result of California’s increasing amount of wildfires. Texas outage increase could be caused by winter storm impact and high summer demands. While Florida has the highest overall customer weighted outage hours, it is only experiencing a mild increase. Pennsylvania remains the lowest out of all four states, and is also showing a pattern of slow increase. (feel free to add more!)

**not sure how good of a graphic this is, outliers are removed from view so you can see the trends

```{r cwhall, fig.cap="Non-seasonal pattern of customer-weighted outage hours for CA, FL, PA, and TX from 2015–2023. Note that some outliers are removed from view. "}
# Add a column for states 
CA_nonseas_cwh_combined <- CA_cwh_outage_components %>%
  mutate(State = "CA",
         nonseas = trend + remainder, 
         Month = as.numeric(outage_group_CA$month))

PA_nonseas_cwh_combined <- CWH_components_PA %>%
  mutate(State = "PA", 
         nonseas = trend + remainder)


TX_nonseas_cwh_combined <- TX_CWH_Components %>%
mutate(State = "TX",
       nonseas = trend + remainder,
       Month = as.numeric(outage_group_TX$month))

FL_nonseas_cwh_combined <- monthly_wHrs_FL.components %>%
  mutate(State = "FL",
         nonseas = trend + remainder)

# Combine the datasets, need to add TX
nonseas_cwh_combined_data <- bind_rows(CA_nonseas_cwh_combined, PA_nonseas_cwh_combined, FL_nonseas_cwh_combined, TX_nonseas_cwh_combined)

nonseas_cwh_combined <- nonseas_cwh_combined_data %>% 
  ggplot(
    aes(
      x = Date,
      y = nonseas,
      color = State)) +
  geom_point(size = 1.5, alpha = 0.5)+
  geom_smooth(method ="lm", se = FALSE, size = 1.5) +
  ylim(0, 1.5e+07)+
  labs(
    x = "Year",
    y = "Customer Weighted Hours",
    title = "Non-Seasonal Trend of Customer Weighted Hours of Power Outages") +
  scale_color_manual(values = c(
  "CA" = "red",
  "PA" = "purple",
  "FL" = "darkgreen",
  "TX" = "blue"))

nonseas_cwh_combined
```


\newpage
# Summary and Conclusions
Summarize your major findings from your analyses in a few paragraphs. What conclusions do you draw from your findings? Relate your findings back to the original research questions and rationale.

In California, power outages have become increasingly common and increasingly disruptive over the past decade. The time-series analysis reveal a noticeable seasonal cycle, with outages typically rising during the summer months and often reaching their highest levels in early fall. This aligns with California's peak wildfire season.  Alongside this seasonal cycle, both the frequency of outages and the total customer impact have trended upward over time, indicating that Californians are experiencing more outages and that these events are affecting larger numbers of customers than in previous years.

In Florida, power outages have gradually increased over the past decade, with a clear seasonal pattern. Outages typically rise during the summer months, a time where Florida experiences extreme heat, storms, and high electricity demand. In contrast, the winter months see far fewer disruptions. Although the exact monthly pattern shifts slightly from year to year, the overall seasonal cycle remains consistent. Long-term patterns show that Florida is experiencing more outages over time, indicating that both environmental pressures such as an increase in storms and growing energy demand may be contributing to the steady upward trend.

After accounting for seasonal patterns, the analysis shows that the number of power outages in Pennsylvania has increased from 2015 to 2023. Outage counts display a clear seasonal trend, with the highest numbers occurring in the summer months of June, July, and August. In contrast, customer-weighted hours do not show a strong seasonal pattern, but there is a slight upward trend over time, indicating that the impact of outages on customers is also gradually increasing. Overall, while outages are becoming more frequent and seasonally concentrated, the effect on customers is rising more moderately.

After running ANOVA and MannKendall tests, the results show that there's an overall increasing trend of power outages in Texas from 2015-2023. The customer weighted outage hours take into account the amount of customers impacted by these outages, which also shows an increasing trend over the study period. However, it is surprising that despite the visual season trend, Texas does not have a seasonal trend of power outages. 

After comparing outage patterns across all four states, Florida and Pennsylvania show clear seasonal patterns in power outages, with events concentrated in the summer,especially July, and dropping sharply in winter. Texas peaks earlier in May, while California has no strong seasonal pattern, though outages rise somewhat in October. ANOVA results confirm this; Florida and Pennsylvania have extremely low p-values, indicating strong seasonality, while California and Texas have high p-values, indicating no statistically significant seasonal trend. These patterns may relate to regional climate factors. Florida and Pennsylvania face strong summer energy demand and storms, Texas experiences diverse weather but no consistent seasonal driver, and California’s fire season varies widely year to year.

From 2015 to 2023, customer-weighted outage hours show a strong upward trend in both California and Texas, indicating growth in the scale of outages. California’s rise is likely tied to increasingly severe wildfires, while Texas’s growth may reflect the combined effects of winter storms and heavy summer electricity demand. Florida, although having the highest overall outage hours, shows only a mild upward trend. Pennsylvania has the lowest outage numbers among the four states and is experiencing only a slight gradual increase over time.

To strengthen the project in the future, we could include more nuanced perspectives by incorporating socioeconomic data to examine the broader impact that power outages could have on a community. It would also be interesting to inspect spatial data and identify areas in a state that are most vulnerable to power outages.

"Further analysis is needed to quantify the relationship between climate-related extreme events and power outages. This should include modelling that links outage counts and customer-weighted hours to event-specific exposures (e.g., hurricane strikes, heatwave intensity, wildfire area, winter storm severity), while controlling for confounders such as population growth, changes in reporting coverage, and utility-level mitigation efforts


\newpage

# References
- IBM. Power grid modernization—Strategies and tactics for resilience and energy transition. (2025, March 21). IBM. https://www.ibm.com/thought-leadership/institute-business-value/en-us/report/power-grid-modernization
- Maxouris, C. (2019, October 10). PG&E has begun cutting power across parts of Northern California. Nearly 800,000 customers will be affected | CNN. https://www.cnn.com/2019/10/09/us/pge-power-outage-wednesday
- NASA. (2023, March 17). Precipitation Piles on in California—NASA Science. https://science.nasa.gov/earth/earth-observatory/precipitation-piles-on-in-california-151107/
- Wendel, J. (2024, July 29). Extreme Heat, Hurricanes, Wildfires: How Summer’s Extremes Disrupt the Power Grid. Pacific Northwest National Laboratory. https://www.pnnl.gov/news-media/extreme-heat-hurricanes-wildfires-how-summers-extremes-disrupt-power-grid
- Wing, I. S., Larsen, P. H., Carvallo, J. P., Sanstad, A., Wei, D., Rose, A., Baik, S., Smith, J., Ramee, C., & Peterson, R. (2025). A Method to estimate the economy-wide consequences of widespread, long duration electric power interruptions. Nature Communications, 16(1), 3335. https://doi.org/10.1038/s41467-025-58537-4

