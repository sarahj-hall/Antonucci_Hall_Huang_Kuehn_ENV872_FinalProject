---
title: 'Power Outage Trends in California, Florida, Pennsylvania, and Texas from 2015 to 2023'
subtitle: 'https://github.com/sarahj-hall/Antonucci_Hall_Huang_Kuehn_ENV872_FinalProject.git'
authors: 'Addisen Antonucci, Sarah Hall, Carina Huang, and Isabelle Kuehn'
date: 'December 12th, 2025'
output: 
  bookdown::pdf_document2:
    toc: true
editor_options:
  chunk_output_type: console

---
\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Load your packages
library(tidyverse)
library(dplyr)
library(here)
library(lubridate)
library(viridis)
library(zoo)

# Set your working directory
here()

# Set ggplot theme
mytheme <- theme_classic(base_size = 12) +
  theme(axis.text = element_text(color = "black"))
theme_set(mytheme)

#set global chunk options
knitr::opts_chunk$set(
  echo = FALSE,      # hide all code
  warning = FALSE,   # hide warnings
  message = FALSE   # hide messages
)

# Load your datasets

#load CA data
#read in CA data from processed folder 
outage_group_CA <- read.csv(here('Data/Processed/outage_group_CA.csv'), 
                            stringsAsFactors = TRUE)
#format date column
outage_group_CA$date <- ymd(outage_group_CA$date)


#load FL data

#load PA data
outage_group_PA <- read.csv(here('Data/Processed/outage_group_PA.csv'), 
                    stringsAsFactors = TRUE)
outage_group_PA$date <- ymd(outage_group_PA$date)

#load TX data
outage_group_TX <- read.csv(here('Data/Processed/outage_group_TX.csv'))
outage_group_TX$date <- ymd(outage_group_TX$date)

```


# Rationale and Research Questions
Write 1-2 paragraph(s) detailing the rationale for your study. This should include both the context of the topic as well as a rationale for your choice of dataset (reason for location, variables, etc.). You may choose to include citations if you like (optional).

At the end of your rationale, introduce a numbered list of your questions (or an overarching question and sub-questions).

Electric power outages are costly, for both grid operators and customers. (expand/give examples and cite). With increasing extreme weather events, the U.S. grid is more vulnerable to outage events. However, there have also been advancements in electric power systems planning, operations, and outage detection. Understanding what trend is occurring in the U.S. with regards to power outages could support.... In additional to the general trend, understanding if power outages follow a seasonal trend, that aligns with extreme weather periods (such as hurricane season), could help states focus their planning (resiliency?) for specific months. Furthermore, power outages may be increasing (or decreasing), but are their impacts the same? Are outage durations increasing? The outage duration helps quantify actual impact, as the longer duration, the more costly.

- damage of outages (health, financial)
- increasing climate related weather events, vulnerable power system infrastructure 
- could be interesting trend/hard to estimate, could be increasing with more grid demand and aging power system + weather events or decreasing with increase grid planning and monitoring technology (or outage length should be decreasing)
- selected four states, tried to spread out geographically but also selected states with the highest power outages/most impacted by recent extreme climate events. Texas, California, Florida, and Pennsylvania 

Four U.S. states were selected for analysis: California, Florida, Pennsylvania, and Texas. These states were selected to cover different geographical areas of the U.S., and due to their large populations. (and vulnerability to climate change?). For all states the following questions were explored: 

## Question 1: How has the frequency of power outages changed over time?
## Question 2: Is there a seasonal trend? Are certain months more prone to outages? 
## Question 3: How has the length of power outages changed over time?  

\newpage

# Dataset Information
Provide information on how the dataset for this analysis were collected, the data contained in the dataset, and any important pieces of information that are relevant to your analyses. This section should contain much of same information as the metadata file for the dataset but formatted in a way that is more narrative.

Describe how you wrangled your dataset in a format similar to a methods section of a journal article.

The Event-correlated Outage Dataset in America was downloaded from the Open Energy Data Initiative (OEDI) (https://data.openei.org/submissions/6458). The dataset includes an aggregated and event-correlated analysis of power outages in the United States. The specific dataset selected for this analysis is the Aggregated Outage Data which integrates data from the Environment for the Analysis of Geo-Located Energy Information (EAGLE-I), and Annual Estimates of the Resident Population for Counties 2024 (CO-EST2024-POP). The EAGLE-I dataset, provides county-level electricity outage estimates at 15-minute intervals from 2014 to 2023. It encompasses over 146 million customers, but this coverage has increased over time from 137 million in 2018. EAGLE-I only start providing . The Aggregated Outage Dataset provides monthly outage data at the state level, including total number of outages, the duration of outages, and the customer weighted average of outages.   

The data was wrangled by combining the yearly data from 2015 to 2023 was combined into one data frame. The year 2014 was removed from the analysis because it did not have monthly data, only the yearly summary. From this file, four datasets were created by filtering for each state (CA, FL, PA, and TX). For each state, the monthly value equal to 0 was filtered out, which represented the yearly summary. Additionally, a date column was added that combined the monthly and yearly columns into a date object.

Add a table that summarizes your data structure (variables, units, ranges and/or central tendencies, data source if multiple are used, etc.). This table can be made in markdown text or inserted as a kable function in an R chunk. If the latter, do not include the code used to generate your table.

This data structure applies to all four state files:



\newpage

# Exploratory Analysis 
Insert exploratory visualizations of your dataset. This may include, but is not limited to, graphs illustrating the distributions of variables of interest and/or maps of the spatial context of your dataset. Format your R chunks so that graphs are displayed but code is not displayed. Accompany these graphs with text sections that describe the visualizations and provide context for further analyses.

Each figure should be accompanied by a caption, and each figure should be referenced within the text.

Scope: think about what information someone might want to know about the dataset before analyzing it statistically. How might you visualize this information?

Initial data exploration of California power outage data suggest a slight increasing trend (Figure \@ref(fig:cayearly)). Furthermore, Figure \@ref(fig:camonthly) shows. 

```{r cayearly, fig.cap="Power outages in California from 2015 to 2023."}
# CA yearly plot 
CA_yearly <- outage_group_CA %>% 
  ggplot(
    mapping = aes(
      x= date,
      y = outage_count
      )) +
  geom_point(size = 2, alpha = 0.7)+
  geom_line()+
  geom_smooth(method ="lm", se = FALSE) +
  labs(
    title = "Number of Power Outages in California from 2015 to 2023",
    y = "Number of Outages",
    x = "Year"
  )

CA_yearly
```

```{r camonthly, fig.cap="Power outages in California from 2015 to 2023 by month."}
#CA monthly plot (for data visualization)
CA_monthly_plot <- outage_group_CA %>% 
  ggplot(
    mapping = aes(
      x=factor(
      month,
      levels=1:12,
      labels=month.abb),
      y = outage_count,
      color = year)
    ) +
 geom_point(size = 2, alpha = 0.7)+
 scale_color_viridis(
   option = "mako", 
   direction = -1)+
  labs(
    title = "Number of Power Outages in California by Month from 2015 to 2023",
    y = "Number of Outages",
    x = "Month",
    color = "Year",
  )

CA_monthly_plot
```

\newpage

```{r txmonthly, fig.cap="Number of Power Outages in Texas from 2015-2023"}
TX_outage_count <- ggplot(outage_group_TX,
                          aes(x = date,
                              y = outage_count))+
  geom_point(size = 2, alpha = 0.6)+
  geom_line()+
  geom_smooth(method = "lm", se = FALSE, color = "blue")+
  ylim(0,3000)+
  labs(title = "Number of Power Outages in Texas from 2015-2023",
       x = "Year",
       y="Number of Outages")

TX_outage_count
```

```{r}
  
TX_outage_count_month <- outage_group_TX %>% 
  filter(month != 0) %>% 
  ggplot(aes(x = factor(month,
                        levels=1:12,
                        labels=month.abb),
                             y = outage_count,
                             color = year))+
  geom_point(size = 2, alpha = 0.6)+
  scale_colour_viridis(option = "mako", direction = -1)+
  labs(title = "Number of Power Outages in Texas by Month from 2015-2023",
       x = "Month",
       y="Number of Outages")

TX_outage_count_month
```
\newpage
```{r}
#Pennsylvania Yearly Power Outage
ggplot(monthly_outages_PA, aes(x = year_month, y = outage_count)) +
  geom_line() +
  labs(
    title = "Number of Power Outages in Pennsylvania from 2015 to 2023",
    x = "Year", 
    y = "Number of Outages") +
  geom_smooth(method = "lm", se = FALSE, color = "#c13d75ff")
  

#PA Monthly Power Outages
PA_monthly_plot <- outage_group_PA %>% 
  ggplot(aes(
    x = factor(month, levels = 1:12, labels = month.abb),
    y = outage_count,
    color = factor(year))) +
  geom_point(size = 2, alpha = 0.7) +
  scale_color_viridis(
    option = "mako", 
    direction = -1,
    discrete = TRUE) +
  labs(
    title = "Number of Power Outages in Pennsylvania by Month from 2015-2023",
    y = "Number of Outages",
    x = "Month",
    color = "Year" ) +
  theme_classic(base_size = 14)

PA_monthly_plot

```

# Analysis
Insert visualizations and text describing your main analyses. Format your R chunks so that graphs are displayed but code and other output is not displayed. Instead, describe the results of any statistical tests in the main text (e.g., “Variable x was significantly different among y groups (ANOVA; df = 300, F = 5.55, p < 0.0001)”). Each paragraph, accompanied by one or more visualizations, should describe the major findings and how they relate to the question and hypotheses. Divide this section into subsections, one for each research question.

Each figure should be accompanied by a caption, and each figure should be referenced within the text

**trying to figure out the best organization for this.. where is the best place for the seasonality component? 

## Question 1: How has the frequency of power outages changed over time?
### 1.1 California 

```{r CAtimeseries, fig.cap="Decomposed components of the California power outage count time series."}
#define first day and first year values 
f_month <- month(first(outage_group_CA$date))
f_year <- year(first(outage_group_CA$date))

#create time series object 
CA_outage_ts <- 
  ts(outage_group_CA$outage_count, 
     start = c(f_year, f_month), 
     frequency = 12)

#decompose and plot
CA_outage_decompose <- stl(CA_outage_ts, 
                           s.window = "periodic")
plot(CA_outage_decompose)

```

```{r trend analysis chunk (no output, use for writing), include=FALSE}
#run monotonic trend analysis 
CA_outage_trend <- trend::smk.test(CA_outage_ts)
CA_outage_trend

summary(CA_outage_trend)

#remove seasonality trend?? and re=run MK test 
#extract the components of each series into a df
CA_outage_compon <- 
  as.data.frame(CA_outage_decompose$time.series[,1:3])

#remove seasonal 
CA_outage_non_seas <- 
  CA_outage_ts - CA_outage_compon[,1]

#rerun MK
CA_outage_trend_noseasons <- trend::mk.test(CA_outage_non_seas)
CA_outage_trend_noseasons
```


```{r CAtrend, fig.cap="Trend component of the California power outage count time series compared to the raw data."}
#adding three new columns, observed outages, month date
CA_outage_components <- mutate(CA_outage_compon,
        Observed = outage_group_CA$outage_count, 
        Month = outage_group_CA$month,
        Date = outage_group_CA$date)

# Visualize how the trend maps onto the data
outage_trend_vis_CA <- ggplot(CA_outage_components) +
  geom_line(aes(y = Observed, x = Date),  size = 0.25) + #observed component
  geom_line(aes(y = trend, x = Date), color = "#c13d75ff") + #trend component (pink)
  geom_hline(yintercept = 0, lty = 2) + #seasonal components can end up wonky w/ less than zero y?
  labs(y = "# of outages",
      title = "Trend Component of California Power Outages Compared to the Raw Data")

outage_trend_vis_CA
```

### 1.2 Florida 
### 1.3 Pennsylvania 
### 1.4 Texas 
```{r}
#time series object
Outage_count_ts <- ts(outage_group_TX$outage_count, 
                      start = c(2015,1), 
                      end = c(2023, 12),
                      frequency = 12)

# Generate the decomposition
Outage_count_Decomposed <- stl(Outage_count_ts, s.window = "periodic")
# Visualize the decomposed series. 
plot(Outage_count_Decomposed)
```

```{r}
# Extract the components and turn them into data frames
Outage_count_Components <- as.data.frame(Outage_count_Decomposed$time.series[,1:3])

Outage_count_Components <- mutate(Outage_count_Components,
        Observed = outage_group_TX$outage_count,     
        Date = outage_group_TX$date)

# Visualize how the trend maps onto the data
ggplot(Outage_count_Components) +
  geom_line(aes(y = Observed, x = Date),  size = 0.25) +
  geom_line(aes(y = trend, x = Date), color = "#c13d75ff") +
  geom_hline(yintercept = 0, lty = 2)+
  ylim (-100,6000)+
  labs(title = "Trend Component of the Texas Power Outage ",
       x = "Year",
       y=" Number of Outages ")
```



### 1.5 Comparision between States

## Question 2: Is there a seasonal trend? Are certain months more prone to outages? 
### 2.1 California 

```{r CAseasonal, fig.cap="Seasonality component of the California power outage count time series yearly data group by month." }
#visualize grouped by month
outage_seas_month_vis_CA <- ggplot(CA_outage_components) +
  geom_line(aes(y = seasonal, 
                x=factor(
                  Month,
                  levels=1:12,
                  labels=month.abb), 
                group = year(Date)), 
                color = "#c13d75ff") +
  geom_hline(yintercept = 0, lty = 2) +
  labs(x = "Month", 
       y = "# of outages",
       title = "Seasonality of Power Outages in California")

outage_seas_month_vis_CA

```

### 2.2 Florida 
### 2.3 Pennsylvania 
### 2.4 Texas 
```{r seasonal, figcap= }
# Visualize how the seasonal cycle maps onto the data
ggplot(Outage_count_Components) +
  geom_line(aes(y = Observed, x = Date),  size = 0.25) +
  geom_line(aes(y = seasonal, x = Date), color = "#c13d75ff") +
  geom_hline(yintercept = 0, lty = 2)+
    ylim (-100,7500)
```
### 2.5 Comparision between States

## Question 3: How has the length of power outages changed over time?  
### 3.1 California 
```{r CACWA, fig.cap="Decomposed components of the California customer weighted outage time series."}
#create time series object 
CA_CWA_ts <- 
  ts(outage_group_CA$customer_weighted_hours, 
     start = c(f_year, f_month), 
     frequency = 12)

#decompose and plot
CA_CWA_decompose <- stl(CA_CWA_ts, 
                           s.window = "periodic")
plot(CA_CWA_decompose)

```

```{r trend analysis, hide output, include=FALSE}
#run monotonic trend analysis 
CA_CWA_trend <- trend::smk.test(CA_CWA_ts)
CA_CWA_trend

summary(CA_CWA_trend)

#remove seasonality for customer weighted average
#extract the components of each series into a df
CA_CWA_compon <- 
  as.data.frame(CA_CWA_decompose$time.series[,1:3])

#remove seasonal 
CA_CWA_non_seas <- 
  CA_CWA_ts - CA_CWA_compon[,1]
```

### 3.2 Florida 
### 3.3 Pennsylvania 
### 3.4 Texas 
### 3.5 Comparision between States

\newpage

# Summary and Conclusions
Summarize your major findings from your analyses in a few paragraphs. What conclusions do you draw from your findings? Relate your findings back to the original research questions and rationale.

\newpage

# References
<add references here if relevant, otherwise delete this section> 
