---
title: 'Power Outage Trends in California, Florida, Pennsylvania, and Texas from 2015 to 2023'
subtitle: 'https://github.com/sarahj-hall/Antonucci_Hall_Huang_Kuehn_ENV872_FinalProject.git'
authors: 'Addisen Antonucci, Sarah Hall, Carina Huang, and Isabelle Kuehn'
date: 'December 12th, 2025'

output: 
  bookdown::pdf_document2:
    toc: true 
    toc_depth: 3
    
editor_options:
  chunk_output_type: console
---
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Load your packages
library(tidyverse)
library(here)
library(lubridate)
library(viridis)
library(zoo)
library(trend)
library(Kendall)
library(cowplot)
library(knitr)
library(kableExtra)

# Set your working directory
here()

# Set ggplot theme
mytheme <- theme_classic(base_size = 10) +
  theme(plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
        axis.title.x = element_text(size = 10.5),
        axis.title.y = element_text(size = 10.5))
theme_set(mytheme)

#set global chunk options
knitr::opts_chunk$set(
  echo = FALSE,      # hide all code
  warning = FALSE,   # hide warnings
  message = FALSE,   # hide messages
  fig.align = "center") #center figures 

# Load your datasets

#load CA data
#read in CA data from processed folder 
outage_group_CA <- read.csv(here('Data/Processed/outage_group_CA.csv'), 
                            stringsAsFactors = TRUE)
#format date column
outage_group_CA$date <- ymd(outage_group_CA$date)


#load FL data (I loaded this in so i could do the ANOVA, feel free to change the names to what fits your analysis)
outage_group_FL <- read.csv(here('Data/Processed/outage_group_FL.csv'), 
                            stringsAsFactors = TRUE)
#format date column
outage_group_FL$date <- ymd(outage_group_FL$date)

#load PA data
outage_group_PA <- read.csv(here('Data/Processed/outage_group_PA.csv'), 
                    stringsAsFactors = TRUE)
outage_group_PA$date <- ymd(outage_group_PA$date)

#load TX data
outage_group_TX <- read.csv(here('Data/Processed/outage_group_TX.csv'))
outage_group_TX$date <- ymd(outage_group_TX$date)

```


# Rationale and Research Questions
Electric power outages are costly for both utilities and their customers. Outages disrupt economic activity, and impact critical facilities such as hosptials (citation). The U.S. electric grid is increasingly vulnerable to outages due to increasing extreme weather events, such as hurricanes, heatwaves, wildfires, and winter storms, which are increasing in frequency and intensity due to climate change (citation). Because many of these events occur during specific times of the year, understanding weather power outages follow a seasonal pattern is important for planning and resilience. If outages tend to occur in specific months, utilities and communities can better allocate resources, resilience investments, and emergency preparedness.

As the weather events are increasing, electric utilities have also made advancements in system planning, grid hardening, and outage detection. Together this raises key questions about weather outages are becoming more or less frequent, whether they show predictable seasonal cycles, and whether their impacts are increasing over time. 

To address these questions, this study focuses on Texas, California, Florida, and Pennsylvania. These states represent diverse geographic regions, climates, and electric power systems. For each state, the study examines trends in frequency of power outages, seasonality, and severity of outages. Customer weighted hours of outages will be used to quantify the impact of outages, as it combines the number of customers affected with the outage duration. 

The research questions of this study are: 

- Question 1: How has the frequency of power outages changed over time?
- Question 2: Is there a seasonal trend? Are certain months more prone to outages? 
- Question 3: How has the severity of power outages changed over time?  

\newpage

# Dataset Information
The Event-correlated Outage Dataset in America by the Pacific Northwest National Laboratory was downloaded from the Open Energy Data Initiative (OEDI) (<https://data.openei.org/submissions/6458>). The dataset includes an aggregated and event-correlated analysis of power outages in the United States. The specific dataset selected for this analysis is the Aggregated Outage Data which integrates data from the Environment for the Analysis of Geo-Located Energy Information (EAGLE-I), and Annual Estimates of the Resident Population for Counties 2024 (CO-EST2024-POP). The EAGLE-I dataset, provides county-level electricity outage estimates at 15-minute intervals from 2014 to 2023. It encompasses over 146 million customers, but this coverage has increased over time from 137 million in 2018. EAGLE-I only started providing data quality estimates starting in 2018. The Aggregated Outage Dataset provides monthly outage data at the state level, including total number of outages, the maximum duration of outages, and the customer weighted average of outages.   

The data was wrangled by combining the yearly data from 2015 to 2023 into one dataframe. The year 2014 was removed from the analysis because it did not have monthly data, only the yearly summary. From this file, four datasets were created by filtering for each state (CA, FL, PA, and TX). For each state, the monthly value equal to 0 was filtered out, which represented the yearly summary. Additionally, a date column was added that combined the monthly and yearly columns into a date object.

This data structure shown in Table \@ref(tab:datastructuretable) applies to all four state datasets. Table \@ref(tab:datasummary) summarizes the key statistical characteristics of each datasets. 

```{r datastructuretable, tab.cap="Summary of Outage Dataset Structure"}
structure_tbl <- tibble::tribble(
  ~Variable, ~Description, ~Units,
  
  "state", "Two-letter state abbreviation", "N/A",
  
  "year", "Year of outage", "N/A",
  
  "month", "Month of outage", "N/A",
  
  "outage_count", "Number of outages per month", "N/A",
  
  "max_outage_duration", "Longest outage duration in a month", "Hours",
  
  "customer_weighted_hours", "Customer-weighted outage hours", "N/A",
  
  "date", "Date of outage", "N/A")

kable(structure_tbl, booktabs = TRUE)%>%
  kable_styling(
    position = "center",
    full_width = FALSE,
    latex_options = "hold_position")   # forces placement of table here
```

```{r datasummary, tab.cap= "Summary Statisitcs of CA, FL, PA, and TX Datasets"}

#combine datasets
all_states <- bind_rows(
  outage_group_CA  %>% mutate(State = "CA"),
  outage_group_TX  %>% mutate(State = "TX"),
  outage_group_FL  %>% mutate(State = "FL"),
  outage_group_PA  %>% mutate(State = "PA")
)

#summary stats 
state_summary <- all_states %>%
  group_by(State) %>%
  summarise(
    outage_count_range = paste0(min(outage_count), "–", max(outage_count)),
    outage_count_mean  = round(mean(outage_count, na.rm = TRUE), 2),
    
    outage_duration_range = paste0(min(max_outage_duration), "–", max(max_outage_duration)),
    outage_duration_mean  = round(mean(max_outage_duration, na.rm = TRUE), 2),
    
    customer_weighted_hours_range = paste0(min(customer_weighted_hours), "–", max(customer_weighted_hours)),
    customer_weighted_hours_mean  = round(mean(customer_weighted_hours, na.rm = TRUE), 2)
  ) %>%
  arrange(State)   # alphabetical order

#table, align values in the center, fix column names, add commas 
kable(state_summary, booktabs = TRUE, align = "c", 
      col.names = c("State", 
                      linebreak("Outage Count\nRange", align = "c"),
                      linebreak("Outage Count\nMean", align = "c"),
                      linebreak("Max Duration\nRange", align = "c"),
                      linebreak("Max Duration\nMean", align = "c"),
                      linebreak("Customer Weighted\nHours Range", align = "c"),
                      linebreak("Customer Weighted\nHours Mean", align = "c")),
      escape = FALSE, #for header break formatting
      format.args = list(big.mark = ","))%>%
  kable_styling(latex_options = c("hold_position", "scale_down")) #shrinks table to fit page 
```


\newpage

# Exploratory Analysis 
Insert exploratory visualizations of your dataset. This may include, but is not limited to, graphs illustrating the distributions of variables of interest and/or maps of the spatial context of your dataset. Format your R chunks so that graphs are displayed but code is not displayed. Accompany these graphs with text sections that describe the visualizations and provide context for further analyses.

Each figure should be accompanied by a caption, and each figure should be referenced within the text.

Scope: think about what information someone might want to know about the dataset before analyzing it statistically. How might you visualize this information?

### California
Initial data exploration of California power outage data suggest a slight increasing trend (Figure \@ref(fig:cayearly)). Furthermore, Figure \@ref(fig:camonthly) shows. 

```{r cayearly, fig.cap="Yearly plot of power outages in California from 2015 to 2023."}
# CA yearly plot 
CA_yearly <- outage_group_CA %>% 
  ggplot(
    mapping = aes(
      x= date,
      y = outage_count
      )) +
  geom_point(size = 2, alpha = 0.7)+
  geom_line()+
  geom_smooth(method ="lm", se = FALSE, color = "red") +
  labs(
    title = "Number of Power Outages in California from 2015 to 2023",
    y = "Number of Outages",
    x = "Year"
  )

CA_yearly
```

```{r camonthly, fig.cap="Monthly plot of power outages in California from 2015 to 2023."}
#CA monthly plot (for data visualization)
CA_monthly_plot <- outage_group_CA %>% 
  ggplot(
    mapping = aes(
      x=factor(
      month,
      levels=1:12,
      labels=month.abb),
      y = outage_count,
      color = factor(year))
    ) +
 geom_point(size = 2, alpha = 0.7)+
 scale_color_viridis(
   option = "mako", 
   direction = -1, 
   discrete = TRUE)+
  labs(
    title = "Number of Power Outages in California by Month from 2015 to 2023",
    y = "Number of Outages",
    x = "Month",
    color = "Year",
  )

CA_monthly_plot
```

\newpage
### Florida
```{r flyearly, fig.cap = "Yearly plot of power outages in Florida from 2015 to 2023."}
#yearly_outages_FL <- outage_group_FL %>%
  #filter(month == 0)

yearly_outages_FL_plot <- ggplot(outage_group_FL, aes(x = date, y = outage_count)) +
  geom_line() + 
  geom_point() +
  geom_smooth(method="lm", se = FALSE, color = "darkgreen") +
  labs(title = "2015-2023 Yearly Outages for Florida",
       y="Outage Count",
       x="Year")

yearly_outages_FL_plot
```

```{r flmonthly, fig.cap="Monthly plot of power outages in Florida from 2015 to 2023."}
#monthly_outages_FL <- outage_group_FL %>%
  #filter(month != 0)

monthly_outages_FL_plot <- ggplot(outage_group_FL, 
                                  aes(x=factor(month, levels = 1:12, labels = month.abb), 
                                      y=outage_count, color = factor(year))) + 
  geom_point(size = 2, alpha = 0.7) +
  scale_colour_viridis(option = "mako", direction = -1, discrete = TRUE) +
  labs(title = "2015-2023 Monthly Outages for Florida",
       y="Outage Count",
       x="Date",
       color = "Year")

monthly_outages_FL_plot
```

\newpage
### Pennsylvania
From the initial data exploration of Pennsylvania, it is clear that power outages have gradually increased over the past decade. On a monthly basis, there is a noticeable rise in outages during the summer months, suggesting a seasonal pattern likely related to weather or energy demand. Overall, the data points to both long-term growth in outage frequency and predictable seasonal fluctuations.

```{r payearly, fig.cap="Yearly plot of power outages in Pennsylvania from 2015 to 2023."}
#Pennsylvania Yearly Power Outage
monthly_outages_PA <- outage_group_PA %>%
  mutate(
    year = year(date),
    month = month(date),
    year_month = as.Date(paste(year, month, "01", sep = "-"))
  ) %>%
  group_by(year_month) %>%
  summarise(outage_count = sum(outage_count))

ggplot(monthly_outages_PA, aes(x = year_month, y = outage_count)) +
  geom_point(size = 2, alpha = 0.7)+
  geom_line() +
  labs(
    title = "Number of Power Outages in Pennsylvania
    from 2015 to 2023",
    x = "Year", 
    y = "Number of Outages") +
  geom_smooth(method = "lm", se = FALSE, color = "purple")+
  theme(plot.title = element_text(hjust = 0.5))

```

```{r pamonthly, fig.cap= "Monthly plot of power outages in Pennsylvania from 2015-2023."}
#PA Monthly Power Outages
PA_monthly_plot <- outage_group_PA %>% 
  ggplot(aes(
    x = factor(month, levels = 1:12, labels = month.abb),
    y = outage_count,
    color = factor(year))) +
  geom_point(size = 2, alpha = 0.7) +
  scale_color_viridis(
    option = "mako", 
    direction = -1,
    discrete = TRUE) +
  labs(
    title = "Number of Power Outages in Pennsylvania\nby Month from 2015-2023",
    y = "Number of Outages",
    x = "Month",
    color = "Year" )

PA_monthly_plot
```

\newpage
### Texas
```{r txyearly, fig.cap="Yearly plot of power outages in Texas from 2015-2023."}
TX_outage_count <- ggplot(outage_group_TX,
                          aes(x = date,
                              y = outage_count))+
  geom_point(size = 2, alpha = 0.6)+
  geom_line()+
  geom_smooth(method = "lm", se = FALSE, color = "blue")+
  ylim(0,3000)+
  labs(title = "Number of Power Outages in Texas from 2015-2023",
       x = "Year",
       y="Number of Outages")

TX_outage_count
```

```{r txmonthly, fig.cap="Monthly plot of power outages in Texas from 2015 to 2023."}
TX_outage_count_month <- outage_group_TX %>% 
  ggplot(aes(x = factor(month,
                        levels=1:12,
                        labels=month.abb),
                             y = outage_count,
                             color = factor(year)))+
  geom_point(size = 2, alpha = 0.7)+
  scale_colour_viridis(option = "mako", direction = -1, discrete = TRUE)+
  labs(title = "Number of Power Outages in Texas by Month from 2015-2023",
       x = "Month",
       y="Number of Outages", 
       color = "Year")

print(TX_outage_count_month)
```

\newpage
# Analysis
Insert visualizations and text describing your main analyses. Format your R chunks so that graphs are displayed but code and other output is not displayed. Instead, describe the results of any statistical tests in the main text (e.g., “Variable x was significantly different among y groups (ANOVA; df = 300, F = 5.55, p < 0.0001)”). Each paragraph, accompanied by one or more visualizations, should describe the major findings and how they relate to the question and hypotheses. Divide this section into subsections, one for each research question.

Each figure should be accompanied by a caption, and each figure should be referenced within the text

**trying to figure out the best organization for this.. where is the best place for the seasonality component? 

## Question 1: How has the frequency of power outages changed over time?
### California 

Figure \@ref(fig:CAtimeseries) displays the decomposed time series of the California power outage frequency from 2015 to 2023. There appears to be clear seasonal trend, which is analyzed further in part (5). 

A MannKendall non seasonal trend analysis was applied to the California power outage frequency dataset with the seasonal component remove, a significant overall increase in power outages over time is observed (MannKendall; tau = 5.437e-01 p < 2.2e-16). Figure \@ref(fig:CAtrend) visualizes the trend compared to the observed frequency of power outages in California. The red line represents the overall increasing trend. 

```{r CAtimeseries, fig.cap="Decomposed components of the California power outage count time series."}
#define first day and first year values 
f_month <- month(first(outage_group_CA$date))
f_year <- year(first(outage_group_CA$date))

#create time series object 
CA_outage_ts <- 
  ts(outage_group_CA$outage_count, 
     start = c(f_year, f_month), 
     frequency = 12)

#decompose and plot
CA_outage_decompose <- stl(CA_outage_ts, 
                           s.window = "periodic")
plot(CA_outage_decompose)

```

```{r CA trend analysis chunk, include=FALSE}
#run monotonic trend analysis, i think this should be removed and just focus on non seas analysis

#CA_outage_trend <- trend::smk.test(CA_outage_ts)
#CA_outage_trend
#summary(CA_outage_trend)

#remove seasonality trend?? and re=run MK test 
#extract the components of each series into a df
CA_outage_compon <- 
  as.data.frame(CA_outage_decompose$time.series[,1:3])

#remove seasonal 
CA_outage_non_seas <- 
  CA_outage_ts - CA_outage_compon[,1]

#rerun MK
CA_outage_trend_noseasons <- trend::mk.test(CA_outage_non_seas)
CA_outage_trend_noseasons

#results:
#data:  CA_outage_non_seas
#z = 8.3362, n = 108, p-value < 2.2e-16
#    S         varS          tau 
#3.141000e+03 1.418810e+05 5.436608e-01 

```

```{r CAtrend, echo=FALSE, fig.cap="Trend versus observation of power outages in California (2015-2023)."}
#adding three new columns, observed outages, month date
CA_outage_components <- mutate(CA_outage_compon,
        Observed = outage_group_CA$outage_count, 
        Month = outage_group_CA$month,
        Date = outage_group_CA$date)

# Visualize how the trend maps onto the data
outage_trend_vis_CA <- ggplot(CA_outage_components) +
  geom_line(aes(y = Observed, x = Date),  size = 0.25) + #observed component
  geom_line(aes(y = trend, x = Date), color = "red") + #trend component (red)
  geom_hline(yintercept = 0, lty = 2) + #seasonal components can end up wonky w/ less than zero y?
  labs(y = "# of outages",
      title = "Trend Component of California Power Outages Compared to the Observed Data")

outage_trend_vis_CA
```

\newpage
### Florida 
```{r FLtimeseries, fig.cap="Time series for FL monthly power outages from 2015 to 2023."}
# Time Series Analysis for FL Monthly Outage Count
first_month_FL <- month(first(outage_group_FL$date))
first_year_FL <- year(first(outage_group_FL$date))

monthly_outages_FL.ts <- ts(outage_group_FL$outage_count, 
                             frequency = 12, start = c(first_year_FL, first_month_FL))

# TS trend analysis
FL_monthly_decomposed <- stl(monthly_outages_FL.ts, s.window = "periodic")
plot(FL_monthly_decomposed, main = "Time Series Analysis for Monthly FL Outages")

#commenting this out (only need the non-seasonal one and this is showing up int the knitted doc)
#FL_monthly_outage_trend <- trend::smk.test(monthly_outages_FL.ts)
#FL_monthly_outage_trend

#summary(FL_monthly_outage_trend)
```

```{r FLdecomp, fig.cap = "FL Trend Analysis for Monthly Outages"}
monthly_outages_FL.components <- as.data.frame(FL_monthly_decomposed$time.series[,1:3])

monthly_outages_FL.components <- mutate(monthly_outages_FL.components,
        Observed = outage_group_FL$outage_count,     
        Date = outage_group_FL$date)

# Trend Plot
fl_trend_plot <- ggplot(monthly_outages_FL.components) +
  geom_line(aes(y = Observed, x = Date),  size = 0.5) +
  geom_line(aes(y = trend, x = Date), color = "darkgreen") +
  labs(
    y = "Outage Count", 
    title = "Trend Component of Florida Power Outages
      Compared to the Observed Data")
#plot
fl_trend_plot
```

```{r FLnonseasonal, fig.cap="FL Nonseasonal Trend Analysis for Monthly Outages", include=FALSE}
#Non-Seasonal Trend Analysis for FL
monthly_outages_FL_nonseasonal <- monthly_outages_FL.ts - monthly_outages_FL.components[,1]

FL_nonseasonal_outage_trend <- trend::smk.test(monthly_outages_FL_nonseasonal)
FL_nonseasonal_outage_trend

summary(FL_nonseasonal_outage_trend)
```

\newpage
### Pennsylvania 
After removing the seasonal component from the Pennsylvania outage time series, the Mann–Kendall trend test revealed a significant positive trend (z = 3.02, n = 108, p = 0.002), indicating that outage frequency has increased from 2015 to 2023. This result supports the hypothesis that outages have become more common during this time, independent of seasonal patterns. The decomposed time-series visualization shows this trend clearly, revealing that even after accounting for monthly fluctuations, the long-term component continues to rise.

```{r PAtimeseries, fig.cap="Decomposed components of the Pennsylvania power outage count time series."}
# Aggregate monthly
monthly_outages_PA <- outage_group_PA %>%
  mutate(
    year = year(date),
    month = month(date),
    year_month = as.Date(paste(year, month, "01", sep = "-"))
  ) %>%
  group_by(year_month) %>%
  summarise(outage_count = sum(outage_count))

# Create time series object
Outages_ts_PA <- ts(monthly_outages_PA$outage_count, 
                    start = c(2015,1), end =c(2023,12), frequency = 12)

#Visualize Decomposed Series
Outage_Decomposed_PA <- stl(Outages_ts_PA, s.window = "periodic")

plot(Outage_Decomposed_PA)

```

```{r warning=TRUE, include=FALSE}
#Mann-Kendall Seasonality Test
Outages_PA_SMK <- Kendall::SeasonalMannKendall(Outages_ts_PA)
Outages_PA_SMK
summary(Outages_PA_SMK)
#p-value is 0.009

#Extracting components into Data Frame
Outage_components_PA<-as.data.frame(Outage_Decomposed_PA$time.series[,1:3])

Outage_components_PA <- mutate(Outage_components_PA,
        Observed = monthly_outages_PA$outage_count,     
        Date = monthly_outages_PA$year_month)

#Mann-Kendall Seasonality Test
Outages_PA_SMK <- Kendall::SeasonalMannKendall(Outages_ts_PA)
Outages_PA_SMK
summary(Outages_PA_SMK)
#p-value is 0.009

#Remove Seasonal
PA_outage_non_seas <- Outages_ts_PA - Outage_components_PA$seasonal

PA_outage_MK_noseason <- trend::mk.test(PA_outage_non_seas)
PA_outage_MK_noseason
#p-value is 0.002
```

```{r PAtrend, fig.cap="Trend versus observation of power outages in Pennsylvania (2015-2023)."}
#Visualize the trends
ggplot(Outage_components_PA)+
  geom_line(aes(y = Observed, x = Date),  size = 0.25) +
  geom_line(aes(y = trend, x = Date), color = "purple") +
  geom_hline(yintercept = 0, lty = 2) +
 labs(y = "# of outages",
      title = "Trend Component of Pennsylvania Power Outages
      Compared to the Observed Data")+
  theme(plot.title = element_text(hjust = 0.5))

```

\newpage
### Texas 

```{r txtimeseries, fig.cap="Decomposed components of the Texas power outage count time series."}
#time series object
TXOutage_count_ts <- ts(outage_group_TX$outage_count, 
                      start = c(2015,1), 
                      end = c(2023, 12),
                      frequency = 12)

# Generate the decomposition
TXOutage_count_Decomposed <- stl(TXOutage_count_ts, s.window = "periodic")
# Visualize the decomposed series. 
plot(TXOutage_count_Decomposed)
```

```{r TXtrend, fig.cap="Trend versus observation of power outages in Texas (2015-2023)."}
# Extract the components and turn them into data frames
TXOutage_count_Components <- as.data.frame(TXOutage_count_Decomposed$time.series[,1:3])

TXOutage_count_Components <- mutate(TXOutage_count_Components,
        Observed = outage_group_TX$outage_count, 
        Month = outage_group_TX$month,
        Date = outage_group_TX$date)

# Visualize how the trend maps onto the data
ggplot(TXOutage_count_Components) +
  geom_line(aes(y = Observed, x = Date),  size = 0.25) +
  geom_line(aes(y = trend, x = Date), color = "blue") +
  geom_hline(yintercept = 0, lty = 2)+
  ylim(-100,3000)+
  labs(title = "Trend Component of the Texas Power Outage ",
       x = "Year",
       y=" Number of Outages ")
```

\newpage
### Comparision between States

\newpage
## Question 2: Is there a seasonal trend? Are certain months more prone to outages? 
### California 

Figure \@ref(fig:CAtimeseries) displays a clear seasonal trend in the decomposed time series of the California power outage frequency. The seasonal trend was isolated and grouped by year to show the Seasonal Cycle of Power Outages in California in Figure \@ref(fig:CAseasonal). The seasonal cycle highlights a potential pattern of power outage frequencies peaking rising in the summer months, peaking in October. However, the frequency of outages in California was not significantly different among the months (ANOVA; df = 11, F = 0.704, p < 0.732). 

```{r CAseasonal, fig.cap="Seasonality component of the California power outage count time series analysis where yearly data is grouped by month.", fig.align='center'}
#visualize grouped by month
outage_seas_month_vis_CA <- ggplot(CA_outage_components) +
  geom_line(aes(y = seasonal, 
                x=factor(
                  Month,
                  levels=1:12,
                  labels=month.abb), 
                group = year(Date)), 
                color = "red") +
  geom_hline(yintercept = 0, lty = 2) +
  labs(x = "Month", 
       y = "# of outages",
       title = "Seasonal Cycle of Power Outages in California")

outage_seas_month_vis_CA

```

```{r CA seasonal anova, include=FALSE}
#testing: “Are outage counts significantly different across months?”
outage_group_CA$month <- factor(month(outage_group_CA$date),
                                levels = 1:12,
                                labels = month.abb)

CA_anova_outage <- aov(data = outage_group_CA, outage_count ~ month)
summary(CA_anova_outage)

#show months
TukeyHSD(CA_anova_outage)

#results:
#Df   Sum Sq Mean Sq F value Pr(>F)
#month       11  1284083  116735   0.704  0.732
#Residuals   96 15923546  165870  
#The frequency of outages in California was not significantly different among the months (ANOVA; df = 11, F = 0.704, p < 0.732.  

```

\newpage
### Florida 

```{r FL seasonal ANOVA, include=FALSE}
##Are outage counts significantly different across months?
##Null Hypothesis: Mean outage counts are the same for all 12 months 
##Alt Hypothesis: At least on month differs (Seasonality)

#format outage group month as factor 
outage_group_FL$month <- factor(month(outage_group_FL$date),
                                levels = 1:12,
                                labels = month.abb)
#run anova
FL_anova_outage <- aov(data = outage_group_FL, outage_count ~ month)
summary(FL_anova_outage)

##The frequency of outages in Florida was significantly different among the months (ANOVA; df = 11, F = 43.28, p < 2e-16. This supports our alternative hypothesis that outages are not evenly distributed throughout the year but instead follow a seasonal pattern. 
```


\newpage
### Pennsylvania 
The Mann–Kendall seasonal trend test for Pennsylvania outage counts indicated a significant seasonal signal in the data ($\tau = 0.20$, p = 0.009), demonstrating that outage frequencies vary across months. This finding supports the hypothesis that outages are not evenly distributed throughout the year but instead follow a seasonal pattern. The visualizations further highlight this pattern, showing clear peaks in June, July, and August, when outage counts are highest. Together, these results suggest that summer months consistently experience elevated outage activity, potentially driven by seasonal weather conditions or increased energy demand.

```{r, fig.cap="Isolated seasonal component of PA power outages."}
#Visualize seasonal Component 
ggplot(Outage_components_PA) +
  geom_line(aes(x = Date, y = seasonal), color = "purple") +
  geom_hline(yintercept = 0) +
   labs(y = "# of outages",
      title = "Trend Component of Pennsylvania Power Outages
      Compared to the Raw Data")+
  theme(plot.title = element_text(hjust = 0.5))

Outage_components_PA$Month <- month(Outage_components_PA$Date)

```

```{r PAseasonal, fig.cap="Single year breakdown of seasonal component of outages in PA."}
#seasonal by month
ggplot(Outage_components_PA) +
  geom_line(aes(
    x = factor(Month, levels = 1:12, labels = month.abb),
    y = seasonal,
    group = year(Date)
  ), color = "purple") +
  geom_hline(yintercept = 0) +
  labs(x = "Month", y = "# of outages",
  title = "Seasonal Cycle of Outages in Pennsylvania")+
  theme(plot.title = element_text(hjust = 0.5))

```

```{r PA seasonal ANOVA, include=FALSE}
##Are outage counts significantly different across months?
##Null Hypothesis: Mean outage counts are the same for all 12 months 
##Alt Hypothesis: At least on month differs (Seasonality)

#format outage group month as factor 
outage_group_PA$month <- factor(month(outage_group_PA$date),
                                levels = 1:12,
                                labels = month.abb)
#run anova
PA_anova_outage <- aov(data = outage_group_PA, outage_count ~ month)
summary(PA_anova_outage)

#show months
TukeyHSD(PA_anova_outage)

##The frequency of outages in Pennsylvania was significantly different among the months (ANOVA; df = 11, F =12.1, p < 7.54e-15. This supports our alternative hypothesis that outages are not evenly distributed throughout the year but instead follow a seasonal pattern.  

```


\newpage
### Texas 
```{r TXseasonal, fig.cap="Seasonality component of the Texas power outage count time series analysis where yearly data is grouped by month."}
# Visualize how the seasonal cycle maps onto the data
ggplot(TXOutage_count_Components) +
  geom_line(aes(y = seasonal, 
                x=factor(Month, levels=1:12, labels=month.abb), 
                group = year(Date)), 
                color = "blue") +
  geom_hline(yintercept = 0, lty = 2) +
  labs(x = "Month", 
       y = "# of outages",
       title = "Seasonality of Power Outages in Texas")
```

```{r TX seasonal ANOVA, include=FALSE}
##Are outage counts significantly different across months?
##Null Hypothesis: Mean outage counts are the same for all 12 months 
##Alt Hypothesis: At least on month differs (Seasonality)
#format month as factor
outage_group_TX$month <- factor(month(outage_group_TX$date),
                                levels = 1:12,
                                labels = month.abb)

#run anova
TX_anova_outage <- aov(data = outage_group_TX, outage_count ~ month)
summary(TX_anova_outage)

#show months
TukeyHSD(TX_anova_outage)

#despite visual apperances of a trend, with power outages peaking in May...
#The frequency of outages in Texas was not significantly different among the months (ANOVA; df = 11, F = 1.215, p < 0.288).  

```


\newpage
### Comparision between States

\newpage
## Question 3: How has the length of power outages changed over time?  
### California 
Figure \@ref(fig:CAcwh) displays the decomposed time series of the California customer weighted hours from 2015 to 2023. However, after removing the seasonality component the Mann-Kendall trend test suggested that there is a significant increase in the customer weighted hours of power outages in California, thus the outage severity (MannKendall; tau 3.513e-01 = p < 7.178e-08).

```{r CAcwh, fig.cap="Decomposed analyis of customer weighted outage time in California"}
#create time series object 
CA_CWA_ts <- 
  ts(outage_group_CA$customer_weighted_hours, 
     start = c(f_year, f_month), 
     frequency = 12)

#decompose and plot
CA_CWA_decompose <- stl(CA_CWA_ts, 
                           s.window = "periodic")
plot(CA_CWA_decompose)

```

```{r CA trend analysis hide output, include=FALSE}
#run monotonic trend analysis 
CA_CWA_trend <- trend::smk.test(CA_CWA_ts)
CA_CWA_trend

summary(CA_CWA_trend)

#remove seasonality for customer weighted average
#extract the components of each series into a df
CA_CWA_compon <- 
  as.data.frame(CA_CWA_decompose$time.series[,1:3])

#remove seasonal 
CA_CWA_non_seas <- 
  CA_CWA_ts - CA_CWA_compon[,1]
```
\newpage
### Florida 

\newpage
### Pennsylvania 
For customer-weighted hours, the seasonal test was not statistically significant (tau = 0.13, p = 0.09), indicating no consistent monthly pattern in outage impacts on customers. However, after de-seasonalizing, the Mann-Kendall trend test suggested a marginally increasing trend in customer-weighted hours over time (z = 1.89, n = 108, p = 0.06). Overall, these results suggest that while outage counts are increasing and show clear seasonality, the impact on customers is also trending upward, though less strongly.

```{r PAcwh, fig.cap = "Decomposed analyis of customer weighted outage time in Pennsylvania."}
# Aggregate monthly
monthly_cwh_PA <- outage_group_PA %>%
  mutate(
    year = year(date),
    month = month(date),
    year_month = as.Date(paste(year, month, "01", sep = "-"))) %>%
  group_by(year_month) %>%
  summarise(customer_weighted_hours = sum(customer_weighted_hours, na.rm = TRUE))

# Create time series object
CWH_ts_PA <- ts(
  monthly_cwh_PA$customer_weighted_hours,
  start = c(2015,1), end =c(2023,12), frequency = 12)

# Visualize Decomposed series
CWH_decompose_PA <- stl(CWH_ts_PA, s.window = "periodic")
plot(CWH_decompose_PA)

#Extracting components into Data Frame
CWH_components_PA <- as.data.frame(CWH_decompose_PA$time.series[,1:3]) %>%
  mutate(Observed = monthly_cwh_PA$customer_weighted_hours,
    Date = monthly_cwh_PA$year_month,
    Month = month(Date))
```

```{r eval=FALSE, include=FALSE}
#Mann-Kendall Seasonality Test
CWH_PA_SMK <- Kendall::SeasonalMannKendall(CWH_ts_PA)
CWH_PA_SMK
summary(CWH_PA_SMK)
#p-value= 0.09

#Remove Seasonal
CWH_non_seas_PA <- CWH_ts_PA - CWH_components_PA$seasonal
CWH_MK_noseason_PA <- trend::mk.test(CWH_non_seas_PA)
CWH_MK_noseason_PA
#p-value=0.06
```

```{r PAcwhTrend, fig.cap = "Trend versus observation of customer-weighted hours in PA (2015-2023)."}
#Visualize the trends
ggplot(CWH_components_PA) +
  geom_line(aes(x = Date, y = Observed)) +
  geom_line(aes(x = Date, y = trend), color = "purple") +
  labs(x = "Date", y = "Customer Weighted Hours",
  title = "Observed vs Trend in
  Customer-Weighted Hours (PA)") +
  geom_hline(yintercept = 0)+
  theme(plot.title = element_text(hjust = 0.5))
```

```{r PAcwhSeas, fig.cap = "Single year breakdown of seasonal component of customer-weighted hours in PA."}
# Seasonal Cycle by Month
ggplot(CWH_components_PA) +
  geom_line(aes(
    x = factor(Month, levels = 1:12, labels = month.abb),
    y = seasonal,
    group = year(Date)
  ), color = "purple") +
  geom_hline(yintercept = 0) +
  labs(x = "Month", y = "Seasonal Component",
  title = "Seasonal Cycle of Customer-Weighted Hours (PA)")+
  theme(plot.title = element_text(hjust = 0.5))
```

\newpage
### Texas 

\newpage
### Comparison between States

\newpage

# Summary and Conclusions
Summarize your major findings from your analyses in a few paragraphs. What conclusions do you draw from your findings? Relate your findings back to the original research questions and rationale.

After accounting for seasonal patterns, the analysis shows that the frequency of power outages in Pennsylvania has increased from 2015 to 2023. Outage counts display a clear seasonal trend, with the highest numbers occurring in the summer months of June, July, and August. In contrast, customer-weighted hours do not show a strong seasonal pattern, but there is a slight upward trend over time, indicating that the impact of outages on customers is also gradually increasing. Overall, while outages are becoming more frequent and seasonally concentrated, the effect on customers is rising more moderately.



\newpage

# References
<add references here if relevant, otherwise delete this section> 
