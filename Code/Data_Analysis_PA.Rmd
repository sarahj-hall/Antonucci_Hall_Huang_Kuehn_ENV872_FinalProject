---
title: "Data_Analysis_PA"
author: "Addisen Antonucci"
date: "2025-12-10"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##  Setting Up
```{r}
#load packages
library(tidyverse)
library(lubridate)
library(trend)
library(zoo)
library(Kendall)
library(tseries)
library(here)

#read in processed PA data
outage_group_PA <- read.csv(here('Data/Processed/outage_group_PA.csv'), 
                    stringsAsFactors = TRUE)
#Set Theme
mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top")
theme_set(mytheme)

#Format Date  
outage_group_PA$date <- ymd(outage_group_PA$date)

```

##  How have outage frequencies changed over time?
###  Initial Plots
```{r}
#Outages by Month
monthly_outages_PA <- outage_group_PA %>%
  mutate(
    year = year(date),
    month = month(date),
    year_month = as.Date(paste(year, month, "01", sep = "-"))
  ) %>%
  group_by(year_month) %>%
  summarise(outage_count = sum(outage_count))

#Time series of Outages
ggplot(monthly_outages_PA, aes(x = year_month, y = outage_count)) +
  geom_line() +
  labs(x = "Year", y = "Outage Count") +
  geom_smooth(method = "lm", color = "#c13d75ff")

```

### Time Series
```{r}
#Creating time Series Objects
Outages_ts_PA <- ts(monthly_outages_PA$outage_count, start = c(2015,1), end =c(2023,12), frequency = 12)

```


```{r}
#Visualize Decomposed Series
Outage_Decomposed_PA <- stl(Outages_ts_PA, s.window = "periodic")

plot(Outage_Decomposed_PA)
```

###  Is there seasonality?
```{r}
#Extracting components into Data Frame
Outage_components_PA<-as.data.frame(Outage_Decomposed_PA$time.series[,1:3])

Outage_components_PA <- mutate(Outage_components_PA,
        Observed = monthly_outages_PA$outage_count,     
        Date = monthly_outages_PA$year_month)

#Visualize the trends
ggplot(Outage_components_PA)+
  geom_line(aes(y = Observed, x = Date),  size = 0.25) +
  geom_line(aes(y = trend, x = Date), color = "#c13d75ff") +
  geom_hline(yintercept = 0, lty = 2) +
  xlab("Date")
  ylab("Outages")
```

```{r}
#Mann-Kendall Seasonality Test
Ouatges_PA_SMK <- Kendall::SeasonalMannKendall(Outages_ts_PA)
Ouatges_PA_SMK
summary(Ouatges_PA_SMK)

#p-value is 0.009
```


## How Have Outage Durations Changed Over Time?
```{r}
# Aggregate max outage duration by month
monthly_duration_PA <- outage_group_PA %>%
  mutate(
    year = year(date),
    month = month(date),
    year_month = as.Date(paste(year, month, "01", sep = "-"))
  ) %>%
  group_by(year_month) %>%
  summarise(max_outage_duration = max(max_outage_duration, na.rm = TRUE))

# Plot monthly outage duration
ggplot(monthly_duration_PA, aes(x = year_month, y = max_outage_duration)) +
  geom_line() +
  labs(x = "Year", y = "Max Outage Duration (hours)",
       title = "Monthly Maximum Outage Duration (PA)") +
  geom_smooth(method = "lm", color = "#c13d75ff")
```
